<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Spring Data Elasticsearch ì„¤ì • ë° ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„ - BingheCompany ğŸ‡°ğŸ‡·</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="BingheCompany ğŸ‡°ğŸ‡·" property="og:site_name">
  
    <meta content="Spring Data Elasticsearch ì„¤ì • ë° ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="ì‹¤í–‰ ê³„íš ë¶„ì„ì„ í†µí•´ ì„œë¹„ìŠ¤ì˜ ì„±ëŠ¥ì„ ê°œì„ í•´ë³´ì." property="og:description">
  
  
    <meta content="https://2021-pick-git.github.io//elasticsearch/" property="og:url">
  
  
    <meta content="2021-10-18T13:00:00+09:00" property="article:published_time">
    <meta content="https://2021-pick-git.github.io//about/" property="article:author">
  
  
    <meta content="https://2021-pick-git.github.io//assets/img/elasticsearch-logo.png" property="og:image">
  
  
    
  
  
    
    <meta content="ë°±ì—”ë“œ" property="article:tag">
    
    <meta content="ElasticSearch" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
  
    <meta name="twitter:title" content="Spring Data Elasticsearch ì„¤ì • ë° ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„">
  
  
    <meta name="twitter:url" content="https://2021-pick-git.github.io//elasticsearch/">
  
  
    <meta name="twitter:description" content="ì‹¤í–‰ ê³„íš ë¶„ì„ì„ í†µí•´ ì„œë¹„ìŠ¤ì˜ ì„±ëŠ¥ì„ ê°œì„ í•´ë³´ì.">
  
  
    <meta name="twitter:image:src" content="https://2021-pick-git.github.io//assets/img/elasticsearch-logo.png">
  

	<meta name="description" content="ì‹¤í–‰ ê³„íš ë¶„ì„ì„ í†µí•´ ì„œë¹„ìŠ¤ì˜ ì„±ëŠ¥ì„ ê°œì„ í•´ë³´ì.">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700|Lato:300,400,700&display=swap" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>

  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/"><img src="/assets/img/mark.jpg" alt="ê¹ƒ-ë“¤ë‹¤ (pick-git)"></a>
      </div>
      <div class="author-name">ê¹ƒ-ë“¤ë‹¤ (pick-git)</div>
      <p>ê¹ƒ-ë“¤ë‹¤ ê¸°ìˆ  ë¸”ë¡œê·¸ì…ë‹ˆë‹¤.</br>ğŸ˜‡ğŸ’ª</br> This is a tech blog for pick-git.</br> ãƒ”ã‚¯ã‚®ãƒˆã®æŠ€è¡“ã®blogã§ã™ã€‚</br> è¿™æ˜¯ pick-git ç§‘æŠ€åšå®¢.</br></p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Contact me</h3>
      <ul>
        <!-- 
          <li><a href="https://twitter.com/artemsheludko_" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        
        
          <li><a href="https://facebook.com/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
         -->
        
          <li class="github"><a href="http://github.com/woowacourse-teams/2021-pick-git" target="_blank"><i class="fa fa-github"></i></a></li>
        
        <!-- 
          <li class="linkedin"><a href="https://in.linkedin.com/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
        
        
          <li class="email"><a href="mailto:example.david@blog.com"><i class="fa fa-envelope-o" aria-hidden="true"></i></a></li>
         -->
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2021 &copy; ê¹ƒ-ë“¤ë‹¤ (pick-git)</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    <div class="page-cover-image">
      <figure>
        <img class="page-image" src=/assets/img/elasticsearch-logo.png alt="Spring Data Elasticsearch ì„¤ì • ë° ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„">
        
      </figure>
    </div> <!-- End Page Cover Image -->
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Spring Data Elasticsearch ì„¤ì • ë° ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„</h1>
        <div class="page-date"><span>2021, Oct 18&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <blockquote>
  <p><a href="https://github.com/xlffm3/spring-data-elasticsearch-practice">ì‹¤ìŠµ Repository</a>ì—ì„œ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</blockquote>

<h2 id="1-elasticsearch">1. Elasticsearch</h2>

<p>ElasticsearchëŠ” Apache Lucene ê¸°ë°˜ì˜ Java ì˜¤í”ˆì†ŒìŠ¤ ë¶„ì‚°í˜• RESTful ê²€ìƒ‰ ë° ë¶„ì„ ì—”ì§„ì…ë‹ˆë‹¤. ë°©ëŒ€í•œ ì–‘ì˜ ë°ì´í„°ì— ëŒ€í•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì €ì¥ê³¼ ê²€ìƒ‰ ë° ë¶„ì„ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì •í˜• ë°ì´í„°, ë¹„ì •í˜• ë°ì´í„°, ì§€ë¦¬ ë°ì´í„° ë“± ëª¨ë“  íƒ€ì…ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ë°ìš”. ElasticsearchëŠ” <strong>JSON ë¬¸ì„œ(Document)ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</strong></p>

<p>ElasticsearchëŠ” ë‹¨ë… ê²€ìƒ‰ì„ ìœ„í•´ ì‚¬ìš©í•˜ê±°ë‚˜, <strong>ELK(Elasticsearch &amp; Logstash &amp; Kibana) ìŠ¤íƒ</strong>ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<h3 id="11-elk">1.1. ELK</h3>

<p><img src="https://user-images.githubusercontent.com/56240505/134549954-b93fedde-f86c-4a31-bae8-9fd02ae7d35f.png" alt="image" /></p>

<p>ë³¸ ê¸€ì˜ ì£¼ì œì™€ëŠ” ë²—ì–´ë‚˜ì§€ë§Œ ELKì— ëŒ€í•´ì„œë„ ì§§ê²Œë‚˜ë§ˆ ì•Œì•„ë´…ì‹œë‹¤. ELKëŠ” Elasticsearch + Logstash + Kibanaë¥¼ ê°™ì´ ì—°ë™í•˜ì—¬ ì‚¬ìš©í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.</p>

<ul>
  <li>Filebeat
    <ul>
      <li>ë¡œê·¸ë¥¼ ìƒì„±í•˜ëŠ” ì„œë²„ì— ì„¤ì¹˜í•´ ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</li>
      <li>Logstash ì„œë²„ë¡œ ë¡œê·¸ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>Logstash
    <ul>
      <li>ë¡œê·¸ ë° íŠ¸ëœì­ì…˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘ê³¼ ì§‘ê³„ ë° íŒŒì‹±í•˜ì—¬ Elasticsearchë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.</li>
      <li>ì •ì œ ë° ì „ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>Elasticsearch
    <ul>
      <li>Logstashë¡œë¶€í„° ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³ , ê²€ìƒ‰ ë° ì§‘ê³„ ë“±ì˜ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>Kibana
    <ul>
      <li>ì €ì¥ëœ ë¡œê·¸ë¥¼ Elasticsearchì˜ ë¹ ë¥¸ ê²€ìƒ‰ì„ í†µí•´ ê°€ì ¸ì˜¤ë©°, ì´ë¥¼ ì‹œê°í™” ë° ëª¨ë‹ˆí„°ë§í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h3 id="12-rdb-ë¹„êµ">1.2. RDB ë¹„êµ</h3>

<p><img src="https://user-images.githubusercontent.com/56240505/134550384-69294c02-20c5-4627-a832-ab0713c55e0b.png" alt="image" />
<img src="https://user-images.githubusercontent.com/56240505/134551520-b15876b6-9216-433c-a336-81a293dd828c.png" alt="image" /></p>

<p>ElasticsearchëŠ” ë°ì´í„°ë¥¼ í–‰ë ¬ ë°ì´í„°ë¡œ ì €ì¥í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, <strong>JSON ë¬¸ì„œ(Document)</strong>ë¡œ ì§ë ¬í™”ëœ ë³µì¡í•œ ìë£Œ êµ¬ì¡°ë¥¼ ì €ì¥í•˜ëŠ” ë°©ì‹ì„ ì±„íƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê¸°ì¡´ RDBì—ì„œ ì‚¬ìš©í•˜ë˜ ìš©ì–´ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¨, ê·¸ì— ëŒ€ì‘í•˜ëŠ” ì í•©í•œ ìš©ì–´ë“¤ì´ ì¡´ì¬í•˜ë‹ˆ ì´ ê¸€ì„ ì½ëŠ”ë° ì–´ë ¤ì›€ì—†ìœ¼ì‹œê¸¸ ë°”ë¼ê² ìŠµë‹ˆë‹¤. ğŸ˜…</p>

<h3 id="13-inverted-index">1.3. Inverted Index</h3>

<p><img src="https://user-images.githubusercontent.com/56240505/134555327-82533784-030d-425b-8683-ee33a728b5fd.png" alt="image" />
<img src="https://user-images.githubusercontent.com/56240505/134555053-daa5f704-5f52-47dc-aa07-0de3bea33e78.png" alt="image" /></p>

<blockquote>
  <p>ElasticsearchëŠ” íŠ¹ì • ë¬¸ì¥ì„ ì…ë ¥ë°›ìœ¼ë©´, íŒŒì‹±ì„ í†µí•´ ë¬¸ì¥ì„ ë‹¨ì–´ ë‹¨ìœ„ë¡œ ë¶„ë¦¬í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤. ë˜í•œ ëŒ€ë¬¸ìë¥¼ ì†Œë¬¸ìë¡œ ì¹˜í™˜í•˜ê±°ë‚˜ ìœ ì‚¬ì–´ ì²´í¬ ë“±ì˜ ì¶”ê°€ ì‘ì—…ì„ í†µí•´ í…ìŠ¤íŠ¸ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.</p>
</blockquote>

<p>ElasticsearchëŠ” <strong>ì—­ ìƒ‰ì¸</strong>ì´ë¼ê³  í•˜ëŠ” ìë£Œ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ì´ëŠ” ì „ë¬¸ ê²€ìƒ‰ì— ìˆì–´ì„œ ë¹ ë¥¸ ì„±ëŠ¥ì„ ë³´ì¥í•©ë‹ˆë‹¤. ì±…ì˜ ì „ë°˜ë¶€ì— ìœ„ì¹˜í•œ ì¼ë°˜ì ì¸ ëª©ì°¨ê°€ Indexë¼ë©´, ì±… í›„ë°˜ë¶€ì— í‚¤ì›Œë“œë§ˆë‹¤ ë‚´ìš©ì„ ì°¾ì•„ë³¼ ìˆ˜ ìˆë„ë¡ ë•ëŠ” ëª©ì°¨ê°€ Reverted Indexì…ë‹ˆë‹¤.</p>

<p>ì—­ ìƒ‰ì¸ì€ ê° Documentì— ë“±ì¥í•˜ëŠ” ëª¨ë“  ê³ ìœ í•œ ë‹¨ì–´ë“¤ì„ ë¦¬ìŠ¤íŠ¸ì—…í•˜ê³ , í•´ë‹¹ ë‹¨ì–´ë“¤ì´ ë“±ì¥í•˜ëŠ” Documentë“¤ì„ ì‹ë³„í•©ë‹ˆë‹¤. ìƒ‰ì¸ì€ ìµœì í™”ëœ Document ì»¬ë ‰ì…˜ì´ë©°, ê° DocumentëŠ” <strong>ë°ì´í„°ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” Key-Value ìŒìœ¼ë¡œ ì´ë£¨ì–´ì§„ Field</strong>ì˜ ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.</p>

<p>ElasticsearchëŠ” ëª¨ë“  Fieldì˜ ë°ì´í„°ë¥¼ ì¸ë±ì‹±í•˜ëŠ”ë°, ì¸ë±ì‹±ëœ FieldëŠ” ê°ê°ì˜ ìµœì í™”ëœ ìë£Œêµ¬ì¡°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í…ìŠ¤íŠ¸ í˜•ì‹ì˜ FieldëŠ” Inverted Indexì— ì €ì¥ë˜ë©°, ìˆ«ì í˜¹ì€ ì§€ë¦¬ ê´€ë ¨ FieldëŠ” BKD íŠ¸ë¦¬ì— ì €ì¥ë©ë‹ˆë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/56240505/135963544-3a9c0ae0-89e8-464f-a4c2-ce3a9095003e.png" alt="image" />
<img src="https://user-images.githubusercontent.com/56240505/135963557-e18dac48-aac9-4c43-b4c5-7ce1fd3d4d68.png" alt="image" /></p>

<p>RDBëŠ” ë°ì´í„° ìˆ˜ì •Â·ì‚­ì œì˜ í¸ì˜ì„±ê³¼ ì†ë„ ë©´ì—ì„œ ê°•ì ì´ ìˆì§€ë§Œ ë‹¤ì–‘í•œ ì¡°ê±´ì˜ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ê³  ì§‘ê³„í•˜ëŠ” ë°ì—ëŠ” êµ¬ì¡°ì ì¸ í•œê³„ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. íŠ¹ì • ë‹¨ì–´ ê²€ìƒ‰ì‹œ ROW ê°œìˆ˜ë§Œí¼ í™•ì¸ì„ ë°˜ë³µí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë°˜ë©´ ë‹¨ì–´ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ElasticsearchëŠ” íŠ¹ì • ë‹¨ì–´ê°€ ì–´ë””ì— ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ ì´ë¯¸ ì•Œê³  ìˆì–´ ëª¨ë“  Documentë¥¼ ê²€ìƒ‰í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>

<p>ë°˜ë©´ ìˆ˜ì •ê³¼ ì‚­ì œëŠ” ë‚´ë¶€ì ìœ¼ë¡œ êµ‰ì¥íˆ ë§ì€ ë¦¬ì†ŒìŠ¤ê°€ ì†Œìš”ë˜ëŠ” ì‘ì—…ì´ë¼, RDBMSë¥¼ ëŒ€ì²´í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.</p>

<h3 id="14-architecture">1.4. Architecture</h3>

<p><img src="https://user-images.githubusercontent.com/56240505/134556753-5133f373-7814-4c4f-8505-6dfbe9f47ed9.png" alt="image" /></p>

<blockquote>
  <p>í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„° ë‚´ ë³µìˆ˜ ê°œì˜ ë…¸ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ì €ì¥ëœ DocumentëŠ” í´ëŸ¬ìŠ¤í„° ì „ì—­ìœ¼ë¡œ ë¶„ë°°ë˜ê¸° ë•Œë¬¸ì— ì–´ëŠ ë…¸ë“œì—ì„œë“  ì¦‰ì‹œ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
</blockquote>

<ul>
  <li>Cluster
    <ul>
      <li>ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ë…¸ë“œë¡œ ì´ë£¨ì–´ì§„ ë…¸ë“œë“¤ì˜ ì§‘í•©ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
      <li>ì„œë¡œ ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„°ëŠ” ë°ì´í„°ì˜ ì ‘ê·¼ ë° êµí™˜ì„ í•  ìˆ˜ ì—†ëŠ” ë…ë¦½ì ì¸ ì‹œìŠ¤í…œìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.</li>
      <li>ì—¬ëŸ¬ ëŒ€ì˜ ì„œë²„ê°€ í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ê±°ë‚˜, í•˜ë‚˜ì˜ ì„œë²„ì— ì—¬ëŸ¬ ê°œì˜ í´ëŸ¬ìŠ¤í„°ê°€ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>Node
    <ul>
      <li>Elasticsearchë¥¼ êµ¬ì„±í•˜ëŠ” í•˜ë‚˜ì˜ ë‹¨ìœ„ í”„ë¡œì„¸ìŠ¤ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>Shard
    <ul>
      <li>ë°ì´í„°ë¥¼ ë¶„ì‚°í•´ì„œ ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
      <li>Scale-Outì„ ìœ„í•´ RDBì˜ Databaseì— í•´ë‹¹í•˜ëŠ” Indexë¥¼ ì—¬ëŸ¬ Shardë¡œ ìª¼ê°­ë‹ˆë‹¤.</li>
      <li>ê¸°ë³¸ì ìœ¼ë¡œ 1ê°œê°€ ì¡´ì¬í•˜ë©°, ê²€ìƒ‰ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ í´ëŸ¬ìŠ¤í„°ì˜ Shard ê°œìˆ˜ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>Replica
    <ul>
      <li>ë˜ ë‹¤ë¥¸ í˜•íƒœì˜ Shardë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
      <li>ë…¸ë“œë¥¼ ì†ì‹¤í–ˆì„ ê²½ìš°, ë°ì´í„°ì˜ ì‹ ë¢°ì„±ì„ ìœ„í•´ Shardë¥¼ ë³µì œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</li>
      <li>ë”°ë¼ì„œ ReplicaëŠ” ì„œë¡œ ë‹¤ë¥¸ ë…¸ë“œì— ìœ„ì¹˜ì‹œí‚¬ ê²ƒì„ ê¶Œì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p>ì¶”ê°€ì ìœ¼ë¡œ, NodeëŠ” <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html">ë‹¤ì–‘í•œ ì—­í• </a>ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>ëŒ€ê·œëª¨ í´ëŸ¬ìŠ¤í„°ì—ì„œ ë¡œë“œ ë°¸ëŸ°ì‹± ì—­í• ì„ í•˜ëŠ” ë…¸ë“œ.</li>
  <li>ë°ì´í„° ë³€í™˜ ë“± ì‚¬ì „ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ ë…¸ë“œ.</li>
  <li>ìƒ‰ì¸ëœ ë°ì´í„° CRUD ë…¸ë“œ.</li>
  <li>ë©”íƒ€ ë°ì´í„° ë“± ì „ì²´ í´ëŸ¬ìŠ¤í„°ë¥¼ ì œì–´í•˜ëŠ” ë§ˆìŠ¤í„° ë…¸ë“œ.
    <ul>
      <li>ì¸ë±ìŠ¤ ìƒì„±ê³¼ ì‚­ì œ.</li>
      <li>ë°ì´í„° ì…ë ¥ì‹œ ìƒ¤ë”© í• ë‹¹.</li>
    </ul>
  </li>
</ul>

<p>ë‹¨ì¼ ë…¸ë“œë¡œ Elasticsearchë¥¼ êµ¬ë™í•  ìˆ˜ ìˆì§€ë§Œ, íŠ¸ë˜í”½ì´ ë§ì•„ì§„ë‹¤ë©´ ë…¸ë“œë³„ë¡œ ì„œë²„ë¥¼ ë¶„ë¦¬í•˜ê±°ë‚˜ ì‘ì—… ë…¸ë“œì— ëŒ€í•´ Scale-Out ë° ë¡œë“œ ë°¸ëŸ°ì‹±ì„ í•¨ìœ¼ë¡œì¨ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>

<h3 id="15-íŠ¹ì§•">1.5. íŠ¹ì§•</h3>

<ol>
  <li>Scale out : Shardë¥¼ í†µí•´ ê·œëª¨ê°€ ìˆ˜í‰ì ìœ¼ë¡œ ëŠ˜ì–´ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ê³ ê°€ìš©ì„± : Replicaë¥¼ í†µí•´ ë°ì´í„°ì˜ ì•ˆì •ì„±ì„ ë³´ì¥í•˜ê³ , ë‹¨ì¼ ì¥ì• ì ì„ ê·¹ë³µí•©ë‹ˆë‹¤.</li>
  <li>Schema Free : Json ë¬¸ì„œë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ë¯€ë¡œ, ìŠ¤í‚¤ë§ˆì˜ ê°œë…ì´ ì—†ìŠµë‹ˆë‹¤.</li>
  <li>RESTful : CRUD ì‘ì—…ì€ RESTful APIë¥¼ í†µí•´ ìˆ˜í–‰ë˜ë©°, ê°ê°ì´ HTTPì˜ PUT / GET / POST / DELETE ë©”ì„œë“œì— ëŒ€ì‘ë©ë‹ˆë‹¤.</li>
</ol>

<p><br /></p>

<h2 id="2-spring-data-elasticsearch">2. Spring Data Elasticsearch</h2>

<p>Spring Data Elasticsearch í”„ë¡œì íŠ¸ëŠ” Elasticsearch ê²€ìƒ‰ ì—”ì§„ì„ ì‚¬ìš©í•˜ëŠ” ì†”ë£¨ì…˜ ê°œë°œì„ ë„ì™€ì£¼ëŠ” ëª¨ë“ˆì…ë‹ˆë‹¤. ë‹¤ìŒ ì‘ì—…ì— ëŒ€í•´ ë†’ì€ ìˆ˜ì¤€ì˜ ì¶”ìƒí™”ë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>Documentì˜ ì €ì¥ê³¼ ê²€ìƒ‰ ë° ì •ë ¬.</li>
  <li>Documentë¥¼ Aggregateë¡œ ì¬êµ¬ì„±.</li>
</ul>

<p>Spring Data JPAê°€ Repository ì¸í„°í˜ì´ìŠ¤ì— ì •ì˜í•œ ë©”ì„œë“œ ì´ë¦„ì„ ë¶„ì„í•´ì„œ JPQLì„ ìë™ìœ¼ë¡œ ìƒì„± ë° ì‹¤í–‰í•´ì£¼ëŠ” ê²ƒì²˜ëŸ¼, Spring Data Elasticsearch ë˜í•œ Repository ì¸í„°í˜ì´ìŠ¤ì— ë©”ì„œë“œë¥¼ ì •ì˜í•¨ìœ¼ë¡œì¨ ì¿¼ë¦¬ë¥¼ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="3-dockerë¥¼-í™œìš©í•œ-elasticsearch-ì„¤ì¹˜">3. Dockerë¥¼ í™œìš©í•œ Elasticsearch ì„¤ì¹˜</h2>

<blockquote>
  <p>Shell</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker pull docker.elastic.co/elasticsearch/elasticsearch:7.10.0
<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">-p</span> 9200:9200 <span class="nt">-p</span> 9300:9300 <span class="nt">-e</span> <span class="s2">"discovery.type=single-node"</span> docker.elastic.co/elasticsearch/elasticsearch:7.10.0
</code></pre></div></div>

<p>ë‹¤ì–‘í•œ ì„¤ì¹˜ ë°©ë²•ì´ ìˆì§€ë§Œ ê·¸ ì¤‘ ê°€ì¥ ê°„í¸í•œ Dockerë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì˜ˆì œëŠ” ë‹¨ì¼ ë…¸ë“œë¡œ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ëŠ”ë°, í´ëŸ¬ìŠ¤í„°ë¥¼ ë©€í‹° ë…¸ë“œë¡œ êµ¬ì„±í•˜ê³  ì‹¶ë‹¤ë©´ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-compose-file">docker-composeë¥¼ í™œìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</a>
9200 í¬íŠ¸ëŠ” HTTP í´ë¼ì´ì–¸íŠ¸ì™€ í†µì‹ ì— ì‚¬ìš©ë˜ë©°, 9300 í¬íŠ¸ëŠ” ë…¸ë“œë“¤ê°„ í†µì‹ í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>

<ul>
  <li>ìµœì‹  ê³µì‹ ë¬¸ì„œ ê¸°ì¤€ Spring Data Elasticsearch 4.2.x ë²„ì „ì´ Elasticsearch 7.10.0. ë²„ì „ê³¼ í˜¸í™˜ë˜ê¸° ë•Œë¬¸ì— 7.10.0 ë²„ì „ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë°›ìŠµë‹ˆë‹¤.</li>
  <li>ë‹¤ë¥¸ ë²„ì „ì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ <a href="https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/#new-features">Srping Data Elasticsearch í”„ë¡œì íŠ¸ ë²„ì „ ë° Elasticsearch ë²„ì „ í˜¸í™˜ ìœ ë¬´</a>ë¥¼ ê¼­ í™•ì¸í•˜ë„ë¡ í•©ì‹œë‹¤.</li>
</ul>

<p><br /></p>

<h2 id="4-spring-boot-ì„¤ì •">4. Spring Boot ì„¤ì •</h2>

<blockquote>
  <p>build.gradle</p>
</blockquote>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-data-JPA'</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-web'</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.data:spring-data-elasticsearch:4.2.2'</span>
    <span class="n">compileOnly</span> <span class="s1">'org.projectlombok:lombok'</span>
    <span class="n">runtimeOnly</span> <span class="s1">'com.h2database:h2'</span>
    <span class="n">annotationProcessor</span> <span class="s1">'org.projectlombok:lombok'</span>
    <span class="n">testImplementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-test'</span>
<span class="o">}</span>
</code></pre></div></div>

<p>í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ Elasticsearch ë²„ì „ê³¼ í˜¸í™˜ë˜ê²Œ Spring Data Elasticsearch 4.2.x ë²„ì „ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ë°›ìŠµë‹ˆë‹¤.</p>

<h3 id="41-elasticsearch-clients-ì„¤ì •">4.1. Elasticsearch Clients ì„¤ì •</h3>

<blockquote>
  <p>ElasticsearchOperations.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ElasticsearchOperations</span> <span class="kd">extends</span> <span class="nc">DocumentOperations</span><span class="o">,</span> <span class="nc">SearchOperations</span> <span class="o">{</span>
    <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Elasticsearch ê´€ë ¨ ì‘ì—…ì„ ìˆ˜í–‰í•  ë•Œ ì£¼ë¡œ ElasticsearchOperations ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ëŠ” DocumentOperations ë° SearchOperations ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p>AbstractElasticsearchConfiguration.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractElasticsearchConfiguration</span> <span class="kd">extends</span> <span class="nc">ElasticsearchConfigurationSupport</span> <span class="o">{</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="kd">abstract</span> <span class="nc">RestHighLevelClient</span> <span class="nf">elasticsearchClient</span><span class="o">();</span>

	<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="o">{</span> <span class="s">"elasticsearchOperations"</span><span class="o">,</span> <span class="s">"elasticsearchTemplate"</span> <span class="o">})</span>
	<span class="kd">public</span> <span class="nc">ElasticsearchOperations</span> <span class="nf">elasticsearchOperations</span><span class="o">(</span><span class="nc">ElasticsearchConverter</span> <span class="n">elasticsearchConverter</span><span class="o">,</span>
			<span class="nc">RestHighLevelClient</span> <span class="n">elasticsearchClient</span><span class="o">)</span> <span class="o">{</span>

		<span class="nc">ElasticsearchRestTemplate</span> <span class="n">template</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ElasticsearchRestTemplate</span><span class="o">(</span><span class="n">elasticsearchClient</span><span class="o">,</span> <span class="n">elasticsearchConverter</span><span class="o">);</span>
		<span class="n">template</span><span class="o">.</span><span class="na">setRefreshPolicy</span><span class="o">(</span><span class="n">refreshPolicy</span><span class="o">());</span>

		<span class="k">return</span> <span class="n">template</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>AbstractElasticsearchConfiguration í´ë˜ìŠ¤ê°€ ElasticsearchOperationsì„ Beanìœ¼ë¡œ ë“±ë¡í•˜ê³  ìˆìŠµë‹ˆë‹¤. êµ¬í˜„ì²´ëŠ” ElasticsearchRestTemplateì´ë„¤ìš”. í•´ë‹¹ ë¶€ë¶„ì„ ê°œë°œìê°€ ì»¤ìŠ¤í…€í•˜ê²Œ Bean ë“±ë¡ì„ í•´ì£¼ë©´ ë©ë‹ˆë‹¤.</p>

<blockquote>
  <p>ElasticSearchConfig.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ElasticSearchConfig</span> <span class="kd">extends</span> <span class="nc">AbstractElasticsearchConfiguration</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">RestHighLevelClient</span> <span class="nf">elasticsearchClient</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ClientConfiguration</span> <span class="n">clientConfiguration</span> <span class="o">=</span> <span class="nc">ClientConfiguration</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">connectedTo</span><span class="o">(</span><span class="s">"localhost:9200"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="k">return</span> <span class="nc">RestClients</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">clientConfiguration</span><span class="o">).</span><span class="na">rest</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Spring Data ElasticsearchëŠ” ElasticsearchClientë¥¼ í†µí•´ Elasticsearch ë…¸ë“œ í˜¹ì€ í´ëŸ¬ìŠ¤í„°ì™€ ì—°ê²°ë©ë‹ˆë‹¤. <strong>ElasticsearchClientë¥¼ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ëŒ€ê²Œ ë” ì¶”ìƒí™”ëœ ElasticsearchOperations í˜¹ì€ ElasticsearchRepositoryë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</strong></p>

<p>ElasticsearchClient êµ¬í˜„ì²´ëŠ” ë¦¬ì•¡í‹°ë¸Œ ì§€ì› ì—¬ë¶€ ë“±ì— ë”°ë¼ ì¢…ë¥˜ê°€ ë‹¤ì–‘í•œë°, RestHighLevelClientê°€ ì¼ë°˜ì ì…ë‹ˆë‹¤. ElasticsearchOperations êµ¬í˜„ì²´ê°€ ì‚¬ìš©í•˜ëŠ” RestHighLevelClientë§Œ Beanìœ¼ë¡œ ë“±ë¡í•´ì£¼ë©´ ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<h3 id="42-logging">4.2. Logging</h3>

<blockquote>
  <p>application.properties</p>
</blockquote>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">logging.level.org.springframework.data.elasticsearch.client.WIRE</span><span class="p">=</span><span class="s">TRACE</span>
</code></pre></div></div>

<p>Spring Data Elasticsearchê°€ ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´, ìœ„ ë¡œê±°ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="5-ì˜ˆì œ-ì½”ë“œ">5. ì˜ˆì œ ì½”ë“œ</h2>

<blockquote>
  <p>User.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Document</span><span class="o">(</span><span class="n">indexName</span> <span class="o">=</span> <span class="s">"users"</span><span class="o">)</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Embedded</span>
    <span class="kd">private</span> <span class="nc">BasicProfile</span> <span class="n">basicProfile</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="nf">User</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BasicProfile</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">description</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceConstructor</span>
    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">BasicProfile</span> <span class="n">basicProfile</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">basicProfile</span> <span class="o">=</span> <span class="n">basicProfile</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// getter ìƒëµ</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>BasicProfile.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicProfile</span> <span class="o">{</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="nf">BasicProfile</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">BasicProfile</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// getter ìƒëµ</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ê³¼ê±°ì˜ Spring Data ElasticsearchëŠ” Jackson ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì§ë ¬í™”í•´ JSONìœ¼ë¡œ ë§µí•‘í–ˆëŠ”ë°, í˜„ì¬ëŠ” Meta Object Mapping ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. JPAì—ì„œ @Entity ì• ë„ˆí…Œì´ì…˜ì„ í†µí•´ íŠ¹ì • í´ë˜ìŠ¤ê°€ RDBì— ì €ì¥ë  í…Œì´ë¸”ì„ì„ ëª…ì‹œí•œ ê²ƒ ì²˜ëŸ¼, @Document ì• ë„ˆí…Œì´ì…˜ìœ¼ë¡œ í•´ë‹¹ í´ë˜ìŠ¤ê°€ ES DBì— ë§µí•‘ë  í´ë˜ìŠ¤ì„ì„ í‘œê¸°í•©ë‹ˆë‹¤.</p>

<p>ë˜í•œ @PersistenceConstructorê°€ ë¶€ì°©ëœ ìƒì„±ìí†µí•´ ES DBì— ì €ì¥ëœ Documentê°€ Aggregateë¡œ ì¬êµ¬ì„±ë©ë‹ˆë‹¤. ê·¸ ì™¸ ê¸°íƒ€ ì• ë„ˆí…Œì´ì…˜ ë° ì„¤ì •ë“¤ì€ ê³µì‹ ë¬¸ì„œë¥¼ í™•ì¸í•˜ê¸¸ ë°”ëë‹ˆë‹¤.</p>

<blockquote>
  <p>ElasticsearchRepository.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@NoRepositoryBean</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ElasticsearchRepository</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">ID</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">PagingAndSortingRepository</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">ID</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="nc">Page</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">searchSimilar</span><span class="o">(</span><span class="no">T</span> <span class="n">entity</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">fields</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Spring Data JPAì—ì„œ ì‚¬ìš©ì ì •ì˜ Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í•  ë•Œ JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•œ ê²ƒì²˜ëŸ¼, ElasticsearchRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•´ ì •ì˜í•˜ë©´ ë©ë‹ˆë‹¤.</p>

<blockquote>
  <p>UserRepository.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserSearchRepository</span> <span class="kd">extends</span> <span class="nc">ElasticsearchRepository</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">CustomUserSearchRepository</span> <span class="o">{</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findByBasicProfile_NameContains</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Spring Data JPAì²˜ëŸ¼ ë©”ì„œë“œ ì´ë¦„ì„ ê¸°ë°˜ìœ¼ë¡œ CRUD ëª…ë ¹ ì¿¼ë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p>ElasticSearchConfig.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableElasticsearchRepositories</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ElasticSearchConfig</span> <span class="kd">extends</span> <span class="nc">AbstractElasticsearchConfiguration</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>@EnableElasticsearchRepositories ì• ë„ˆí…Œì´ì…˜ì„ ë¶€ì°©í•´ì¤ë‹ˆë‹¤.</p>

<blockquote>
  <p>CustomUserSearchRepositoryImpl.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomUserSearchRepositoryImpl</span> <span class="kd">implements</span> <span class="nc">CustomUserSearchRepository</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ElasticsearchOperations</span> <span class="n">elasticsearchOperations</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">searchByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Criteria</span> <span class="n">criteria</span> <span class="o">=</span> <span class="nc">Criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">"basicProfile.name"</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CriteriaQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">setPageable</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
        <span class="nc">SearchHits</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">search</span> <span class="o">=</span> <span class="n">elasticsearchOperations</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">search</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">SearchHit:</span><span class="o">:</span><span class="n">getContent</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì§ì ‘ ë‹¤ë¤„ì•¼ í•œë‹¤ë©´ ElasticsearchOperations Beanì„ ì£¼ì…ë°›ì•„ ì»¤ìŠ¤í…€í•˜ê²Œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p>UserController.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/api"</span><span class="o">)</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/users"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">UserRequest</span> <span class="n">userRequest</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">UserRequestDto</span> <span class="n">userRequestDto</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserRequestDto</span><span class="o">(</span>
            <span class="n">userRequest</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
            <span class="n">userRequest</span><span class="o">.</span><span class="na">getDescription</span><span class="o">()</span>
        <span class="o">);</span>
        <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">userRequestDto</span><span class="o">);</span>
        <span class="no">URI</span> <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">created</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/users/{name}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">UserResponse</span><span class="o">&gt;&gt;</span> <span class="nf">search</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">UserResponse</span><span class="o">&gt;</span> <span class="n">userResponses</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">searchByName</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">pageable</span><span class="o">)</span>
            <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">UserResponse:</span><span class="o">:</span><span class="n">from</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">userResponses</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>UserService.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Slf4j</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserSearchRepository</span> <span class="n">userSearchRepository</span><span class="o">;</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">save</span><span class="o">(</span><span class="nc">UserRequestDto</span> <span class="n">userRequestDto</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="n">userRequestDto</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">userRequestDto</span><span class="o">.</span><span class="na">getDescription</span><span class="o">());</span>
        <span class="nc">User</span> <span class="n">savedUser</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">userSearchRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">savedUser</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">UserResponseDto</span><span class="o">&gt;</span> <span class="nf">searchByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// userSearchRepository.findByBasicProfile_NameContains(name) ê°€ëŠ¥</span>
        <span class="k">return</span> <span class="n">userSearchRepository</span><span class="o">.</span><span class="na">searchByName</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">pageable</span><span class="o">)</span>
            <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">UserResponseDto:</span><span class="o">:</span><span class="n">from</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ê°„ë‹¨í•œ User ì €ì¥ ë° ê²€ìƒ‰ ì˜ˆì œ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ìì„¸í•œ ì½”ë“œëŠ” ê¸€ ìƒë‹¨ì— ìœ„ì¹˜í•œ <a href="https://github.com/xlffm3/spring-data-elasticsearch-practice">ì‹¤ìŠµ Repository</a> ë§í¬ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

<h3 id="51-íŠ¸ëŸ¬ë¸”-ìŠˆíŒ…">5.1. íŠ¸ëŸ¬ë¸” ìŠˆíŒ…</h3>

<blockquote>
  <p>Log</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The bean 'userRepository', defined in com.example.elasticsearch.user.domain.UserRepository defined in @EnableJpaRepositories declared on JpaRepositoriesRegistrar.EnableJpaRepositoriesConfiguration, could not be registered.
A bean with that name has already been defined in com.example.elasticsearch.user.domain.UserRepository defined in @EnableElasticsearchRepositories declared on ElasticsearchRepositoriesRegistrar.EnableElasticsearchRepositoriesConfiguration and overriding is disabled.

Action:

Consider renaming one of the beans or enabling overriding by setting spring.main.allow-bean-definition-overriding=true
</code></pre></div></div>

<p>Spring Data Elasticsearch ë‹¨ì¼ ëª¨ë“ˆì„ ì‚¬ìš©í•  ë•ŒëŠ” ë¬¸ì œê°€ ì—†ëŠ”ë°, ì˜ˆì œ ì½”ë“œì²˜ëŸ¼ Spring Data JPAì™€ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ApplicationContext ë¡œë“œì— ì‹¤íŒ¨í•©ë‹ˆë‹¤.</p>

<p>User í´ë˜ìŠ¤ë¥¼ ìœ„í•´ ìƒì„±í•œ JPAìš© Repositoryì™€ Elasticsearchìš© Repository ì¸í„°í˜ì´ìŠ¤ ëª¨ë‘ <code class="language-plaintext highlighter-rouge">PagingAndSortingRepository&lt;T, ID&gt;</code>ë¥¼ í™•ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ ê²°ê³¼ @EnableAutoConfigurationì„ ê¸°ë°˜ìœ¼ë¡œ Beanì„ ì£¼ì…í•˜ëŠ” ê³¼ì •ì—ì„œ Bean ì¤‘ë³µ ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>

<blockquote>
  <p>application.properties</p>
</blockquote>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.main.allow-bean-definition-overriding</span><span class="p">=</span><span class="s">true</span>
</code></pre></div></div>

<p>Beanì„ ì˜¤ë²„ë¼ì´ë”©í•  ìˆ˜ ìˆë„ë¡ ìƒê¸° ì˜µì…˜ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•´ë³´ë©´ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ”ë°ìš”.</p>

<blockquote>
  <p>Trouble Annotations</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableJpaRepositories</span>
<span class="nd">@EnableElasticsearchRepositories</span>
</code></pre></div></div>

<p>@EnableJpaRepositories ë° @EnableElasticsearchRepositories ë“± ë‘ ì• ë„ˆí…Œì´ì…˜ì€ ê¸°ë³¸ì ìœ¼ë¡œ Repository ê´€ë ¨ í´ë˜ìŠ¤ë¥¼ <strong>ëª¨ë‘</strong> ìŠ¤ìºë‹í•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤.</p>

<blockquote>
  <p>Log</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UnsupportedFragmentException: Repository com.example.elasticsearch.user.domain.UserRepository implements org.springframework.data.repository.query.QueryByExampleExecutor but ElasticsearchRepositoryFactory does not support Query by Example!
</code></pre></div></div>

<p>@EnableElasticsearchRepositories ì• ë„ˆí…Œì´ì…˜ì´ JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•œ JPA ê´€ë ¨ í´ë˜ìŠ¤ë¥¼ ìŠ¤ìºë‹í•˜ë©´ ìœ„ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>

<blockquote>
  <p>Log</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Caused by: org.springframework.data.mapping.PropertyReferenceException: No property searchSimilar found for type User!

í˜¹ì€

Caused by: org.springframework.data.mapping.PropertyReferenceException: No property index found for type User!
</code></pre></div></div>

<p>ë°˜ëŒ€ë¡œ @EnableJpaRepositories ì• ë„ˆí…Œì´ì…˜ì´ ElasticsearchRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•œ Elasticsearch ê´€ë ¨ í´ë˜ìŠ¤ë¥¼ ìŠ¤ìºë‹í•˜ë©´ ìœ„ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>

<blockquote>
  <p>ElasticSearchConfig.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableElasticsearchRepositories</span><span class="o">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="nc">UserSearchRepository</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ElasticSearchConfig</span> <span class="kd">extends</span> <span class="nc">AbstractElasticsearchConfiguration</span> <span class="o">{</span>

    <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>ElasticsearchApplication.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableJpaRepositories</span><span class="o">(</span><span class="n">excludeFilters</span> <span class="o">=</span> <span class="nd">@ComponentScan</span><span class="o">.</span><span class="na">Filter</span><span class="o">(</span>
    <span class="n">type</span> <span class="o">=</span> <span class="nc">FilterType</span><span class="o">.</span><span class="na">ASSIGNABLE_TYPE</span><span class="o">,</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="nc">UserSearchRepository</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ElasticsearchApplication</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">ElasticsearchApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>ë”°ë¼ì„œ @EnableElasticsearchRepositories ì• ë„ˆí…Œì´ì…˜ì€ Elasticsearch ê´€ë ¨ Repository í´ë˜ìŠ¤ë§Œ ìŠ¤ìºë‹í•˜ë„ë¡ í•©ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ @EnableJpaRepositories ì• ë„ˆí…Œì´ì…˜ì€ JPA ê´€ë ¨ Repository í´ë˜ìŠ¤ë§Œ ìŠ¤ìºë‹í•˜ë„ë¡ í•©ë‹ˆë‹¤.</p>

<p>@EnableXXX ê´€ë ¨ ì• ë„ˆí…Œì´ì…˜ì„ ì˜ ì„¤ì •í–ˆë‹¤ë©´ í•„ìš”ì—†ëŠ” <code class="language-plaintext highlighter-rouge">spring.main.allow-bean-definition-overriding=true</code> ì˜µì…˜ì€ ì œê±°í•˜ì…”ë„ ë©ë‹ˆë‹¤.</p>

<h3 id="52-ë™ì‘-í™•ì¸">5.2. ë™ì‘ í™•ì¸</h3>

<p>ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•´ë³´ê³  Elasticsearch ì„œë²„ë¡œì˜ ë°ì´í„° ì“°ê¸° ë° ì¡°íšŒê°€ ì›í™œí•˜ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.</p>

<p>RDBëŠ” SQL ì¿¼ë¦¬ë¥¼ í†µí•´ CRUD ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤ë©´, ElasticsearchëŠ” <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current//docs.html">RESTful API</a> ì¿¼ë¦¬ë¥¼ í†µí•´ CRUD ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. Spring Data JPAê°€ ìë™ìœ¼ë¡œ SQL ì¿¼ë¦¬ë¥¼ ìƒì„±í•´ DB ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì²˜ëŸ¼, Spring Data Elasticsearch ë˜í•œ RESTful API ì¿¼ë¦¬ë¥¼ ìƒì„±í•´ ES DB ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/56240505/137831507-5fd54393-e2ca-4ece-99cd-ef0c120ec350.png" alt="image" /></p>

<p><code class="language-plaintext highlighter-rouge">jinhong</code>ì´ë¼ëŠ” ë¬¸ìì—´ì´ í¬í•¨ëœ ëª¨ë“  User ê²€ìƒ‰ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/56240505/137831649-b38a0587-b114-4575-b26b-0ac2351e69f9.png" alt="image" /></p>

<p>RESTfulí•œ GET ìš”ì²­ì„ í†µí•´ ES DBì— ì €ì¥ëœ Documentë¥¼ ì¡°íšŒí•œ ëª¨ìŠµì…ë‹ˆë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/56240505/137831732-2ffed90b-9ea6-45ba-ba2e-f8502350975f.png" alt="image" /></p>

<p><code class="language-plaintext highlighter-rouge">COUNT(*)</code> SQL ì¿¼ë¦¬ì²˜ëŸ¼ ëª‡ ëª…ì˜ ìœ ì €ê°€ ì €ì¥ë˜ì–´ìˆëŠ”ì§€ ì¹´ìš´íŒ…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p>Query</p>
</blockquote>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">/users/_delete_by_query</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"gte"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>User IDê°€ 1ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì€ ê²½ìš° ì‚­ì œí•˜ê² ë‹¤ëŠ” ì¿¼ë¦¬ë¥¼ ìš”ì²­ ë³¸ë¬¸ì— ë‹´ì•„ ì‚­ì œë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. SQL ì¿¼ë¦¬ê°€ ë‹¤ì–‘í•œ ê²ƒì²˜ëŸ¼ Elasticsearch ë˜í•œ ë‹¤ì–‘í•œ RESTful API ì¿¼ë¦¬ê°€ ì¡´ì¬í•˜ë‹ˆ, ìì„¸í•œ ë‚´ìš©ì€ ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.</p>

<p><br /></p>

<h2 id="6-trade-off">6. Trade-Off</h2>

<p>í–‰ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” RDBì—ì„œ íŠ¹ì • í‚¤ì›Œë“œê°€ í¬í•¨ëœ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ LIKE ì¿¼ë¦¬ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ë¬¸ì œëŠ” <code class="language-plaintext highlighter-rouge">LIKE '%jinhong%'</code>ê³¼ ê°™ì´ <code class="language-plaintext highlighter-rouge">jinhong</code> í‚¤ì›Œë“œê°€ ë“¤ì–´ê°„ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ, <code class="language-plaintext highlighter-rouge">%</code> ê¸°í˜¸ë¥¼ ì•ì— ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•œ ì¸ë±ìŠ¤ ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/56240505/137668936-6fd70a7a-702a-4ec8-8a07-e1b245357824.png" alt="image" /></p>

<p>2ëŒ€ì˜ ì¡°íšŒ Slave DB(Replication)ë¥¼ ì‚¬ìš©í•˜ëŠ” ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŠ¹ì • ì´ë¦„ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ìœ ì € ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•œ ê²°ê³¼ì…ë‹ˆë‹¤. í‰ê·  TPSê°€ 38.9ì…ë‹ˆë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/56240505/137674715-51fcf017-29dd-4f60-bf16-3004f37e1079.png" alt="image" /></p>

<p><strong>í‚¤ì›Œë“œ ê²€ìƒ‰ ìš”ì²­</strong> ìƒí™©ì—ì„œ RDBë¥¼ ES ê²€ìƒ‰ ì—”ì§„ìœ¼ë¡œ ëŒ€ì²´í•˜ë©´ ì„±ëŠ¥ ì´ì ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ESë¥¼ ë„ì…í•œ ë‹¤ìŒ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ë™ì¼ í™˜ê²½ì—ì„œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. ESì˜ ê²½ìš° ë‹¨ 1ëŒ€ì˜ ì„œë²„ë§Œìœ¼ë¡œë„ í‰ê·  TPSê°€ 82.2ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤! ì´ëŠ” 2ëŒ€ì˜ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” ê¸°ì¡´ì˜ RDB ë°©ì‹ë³´ë‹¤ ì„±ëŠ¥ì´ 2ë°° ì´ìƒì„ ìƒíšŒí•©ë‹ˆë‹¤.</p>

<p>ë¬¼ë¡  Elasticsearchë¼ëŠ” ë³„ë„ì˜ DBë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ê³ ë ¤í•´ì•¼í•  ê´€ë¦¬ í¬ì¸íŠ¸ê°€ ë§ì•„ì§„ë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.</p>

<ul>
  <li>ê¸°ì¡´ RDBì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ESë¡œ ì´ê´€í•´ì•¼ í•©ë‹ˆë‹¤.</li>
  <li>ì—…ë°ì´íŠ¸ ë°œìƒì‹œ RDBì™€ì˜ ë°ì´í„° ì •í•©ì„±ì„ ì œëŒ€ë¡œ ìœ ì§€í•´ì•¼í•©ë‹ˆë‹¤.</li>
  <li>ESëŠ” ë£¨ì”¬ ì“°ê¸° ì„±ëŠ¥ì´ ë‚˜ìœ ë§Œí¼, ì—…ë°ì´íŠ¸ ë°©ì‹ì— ëŒ€í•œ ì¶”ê°€ì ì¸ ì˜ì‚¬ê²°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
    <ul>
      <li>RDB - ES ê°„ì˜ ë°ì´í„° ì‹±í¬ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë§ì¶œ ê²ƒì¸ì§€, í˜¹ì€ ë°°ì¹˜ ë°©ì‹ì„ ì‚¬ìš©í•  ê²ƒì¸ì§€ ë“±.</li>
      <li>ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„° ì‹±í¬ë¥¼ ë§ì¶”ë©´ ES ì„œë²„ íŠ¸ë˜í”½ì´ ì¦ê°€í•˜ê³  ì“°ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠë¼ ë§ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.</li>
      <li>Bulk API ê¸°ë°˜ì˜ ë°°ì¹˜ ë°©ì‹ìœ¼ë¡œ ë°ì´í„° ì‹±í¬ë¥¼ ë§ì¶”ë©´ Documentì˜ ë°˜ë³µ ì—…ë°ì´íŠ¸ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìœ¼ë‚˜, ë°ì´í„° ì‹±í¬ì— ì§€ì—°ì´ ë°œìƒí•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ê³ ê°€ìš©ì„±ì„ ìœ„í•œ ë‹¨ì¼ ì¥ì• ì  ê·¹ë³µì„ ìœ„í•´ ES í´ëŸ¬ìŠ¤í„°ë§ ë° ìƒ¤ë”© ë“± ì•„í‚¤í…ì³ì— ëŒ€í•œ ê³ ë ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.</li>
</ul>

<p><br /></p>

<hr />

<h2 id="references">References</h2>

<ul>
  <li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.15/index.html">Elasticsearch Guide Docs</a></li>
  <li><a href="https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/#preface">Spring Data Elasticsearch - Reference Documentation</a></li>
  <li><a href="https://steemit.com/elk/@modolee/elk-stack">ELK Stackì„ ì´ìš©í•œ ë¡œê·¸ ê´€ì œ ì‹œìŠ¤í…œ ë§Œë“¤ê¸°</a></li>
  <li><a href="https://victorydntmd.tistory.com/308">ğŸ™ˆ[Elasticsearch] ê¸°ë³¸ ê°œë…ì¡ê¸°ğŸµ</a></li>
  <li><a href="https://stackoverflow.com/questions/36252099/no-property-index-found-for-type-user">No property index found for type User</a></li>
  <li><a href="https://www.samsungsds.com/kr/insights/elastic_data_modeling.html">ì—˜ë¼ìŠ¤í‹±ì„œì¹˜(Elasticsearch)ì—ì„œ ê´€ê³„í˜• ë°ì´í„° ëª¨ë¸ë§í•˜ê¸°</a></li>
</ul>

      <div class="page-footer">
        <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=Spring Data Elasticsearch ì„¤ì • ë° ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„&url=https://2021-pick-git.github.io//elasticsearch/" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=https://2021-pick-git.github.io//elasticsearch/" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=https://2021-pick-git.github.io//elasticsearch/" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div>
        <div class="page-tag">
          
            <a href="/tags#ë°±ì—”ë“œ" class="tag">&#35; ë°±ì—”ë“œ</a>
          
            <a href="/tags#ElasticSearch" class="tag">&#35; ElasticSearch</a>
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->

  <script src="https://utteranc.es/client.js"
        repo="2021-pick-git/pick-git-comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
</article> <!-- End Article Page -->

</div>

  </div>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
