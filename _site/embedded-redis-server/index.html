<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>내장 Redis 설정기 - BingheCompany 🇰🇷</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="BingheCompany 🇰🇷" property="og:site_name">
  
    <meta content="내장 Redis 설정기" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="내장 Redis 설정기" property="og:description">
  
  
    <meta content="https://2021-pick-git.github.io//embedded-redis-server/" property="og:url">
  
  
    <meta content="2021-10-19T15:00:00+09:00" property="article:published_time">
    <meta content="https://2021-pick-git.github.io//about/" property="article:author">
  
  
    <meta content="https://2021-pick-git.github.io//assets/img/redis_icon.png" property="og:image">
  
  
    
  
  
    
    <meta content="백엔드" property="article:tag">
    
    <meta content="Redis" property="article:tag">
    
    <meta content="Embedded" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
  
    <meta name="twitter:title" content="내장 Redis 설정기">
  
  
    <meta name="twitter:url" content="https://2021-pick-git.github.io//embedded-redis-server/">
  
  
    <meta name="twitter:description" content="내장 Redis 설정기">
  
  
    <meta name="twitter:image:src" content="https://2021-pick-git.github.io//assets/img/redis_icon.png">
  

	<meta name="description" content="내장 Redis 설정기">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700|Lato:300,400,700&display=swap" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>

  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/"><img src="/assets/img/mark.jpg" alt="깃-들다 (pick-git)"></a>
      </div>
      <div class="author-name">깃-들다 (pick-git)</div>
      <p>깃-들다 기술 블로그입니다.</br>😇💪</br> This is a tech blog for pick-git.</br> ピクギトの技術のblogです。</br> 这是 pick-git 科技博客.</br></p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Contact me</h3>
      <ul>
        <!-- 
          <li><a href="https://twitter.com/artemsheludko_" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        
        
          <li><a href="https://facebook.com/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
         -->
        
          <li class="github"><a href="http://github.com/woowacourse-teams/2021-pick-git" target="_blank"><i class="fa fa-github"></i></a></li>
        
        <!-- 
          <li class="linkedin"><a href="https://in.linkedin.com/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
        
        
          <li class="email"><a href="mailto:example.david@blog.com"><i class="fa fa-envelope-o" aria-hidden="true"></i></a></li>
         -->
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2021 &copy; 깃-들다 (pick-git)</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    <div class="page-cover-image">
      <figure>
        <img class="page-image" src=/assets/img/redis_icon.png alt="내장 Redis 설정기">
        
      </figure>
    </div> <!-- End Page Cover Image -->
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">내장 Redis 설정기</h1>
        <div class="page-date"><span>2021, Oct 19&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <p>안녕하세요 :) 마크입니다!</p>

<h1 id="목차">목차</h1>

<p><br /></p>

<ul>
  <li><a href="#목차">목차</a></li>
  <li><a href="#들어가며">들어가며</a></li>
  <li><a href="#테스트-환경-구축">테스트 환경 구축</a>
    <ul>
      <li><a href="#의존성">의존성</a></li>
      <li><a href="#테스트-도메인-생성">테스트 도메인 생성</a></li>
    </ul>
  </li>
  <li><a href="#내장-redis-port-수동-설정">내장 Redis port 수동 설정</a></li>
  <li><a href="#내장-redis-port-자동-설정">내장 Redis port 자동 설정</a></li>
  <li><a href="#사용시-주의할-점---중요">사용시 주의할 점 - 중요</a>
    <ul>
      <li><a href="#메모리-확인">메모리 확인</a></li>
      <li><a href="#netstat-확인">netstat 확인</a></li>
      <li><a href="#m1">M1</a></li>
    </ul>
  </li>
  <li><a href="#마치며">마치며</a></li>
  <li><a href="#참고">참고</a></li>
</ul>

<p><br /></p>

<h1 id="들어가며">들어가며</h1>

<p>토큰과 캐싱 개발 초기엔 내장 Redis가 존재하는지 모르고, RedisRepository 역할을 하는 객체를 직접 자바 코드로 구현하여 테스트를 진행했다.</p>

<p>즉, Fake 객체를 만들어서 테스트하는 방법을 택했다.</p>

<p>이렇게 테스트 하는 것의 가장 큰 문제는 실제 Redis 환경이 아니란 점이다..</p>

<p>그래서 Embedded H2처럼 Embedded Redis도 있다 찾아봤고, 적용시키는 시점에서 모르는 것이 많아 삽질을 통해 많은 것을 배울 수 있었고, 이참에 정리하게 되었다.</p>

<p><br /></p>

<blockquote>
  <p>본 글은 <a href="https://jojoldu.tistory.com/297">이동욱님의 - [Redis] SpringBoot Data Redis 로컬/통합 테스트 환경 구축하기</a>와</p>

  <p>아라한사님께서 번역하신 <a href="http://arahansa.github.io/docs_spring/redis.html">스프링 데이터 레디스</a> 를 참고하여 작성된 글입니다.</p>
</blockquote>

<p><br /></p>

<h1 id="테스트-환경-구축">테스트 환경 구축</h1>

<p><br /></p>

<h2 id="의존성">의존성</h2>
<p>먼저 의존성을 주입해준다.</p>
<pre><code class="language-build.gradle">implementation group: 'org.springframework.boot', name: 'spring-boot-starter-data-redis', version: '2.5.4'
implementation (group: 'it.ozimov', name: 'embedded-redis', version: '0.7.3') {
    exclude group: 'org.slf4j', module: 'slf4j-simple'
}
</code></pre>
<ul>
  <li>Spring Data Redis
    <ul>
      <li>Spring Data JPA처럼 Redis를 JPA Repository 사용하듯 인터페이스를 제공하는 모듈.</li>
    </ul>
  </li>
  <li>embedded-redis
    <ul>
      <li>기존 <code class="language-plaintext highlighter-rouge">it.ozimov.embedded-redis</code>안에 <code class="language-plaintext highlighter-rouge">slf4j-simple</code>이 내장되어 있어서, 필자는 slf4j에 대한 충돌이 발생하였다. 그래서 이를 제외시켰다.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="테스트-도메인-생성">테스트 도메인 생성</h2>
<p>테스트를 위한 도메인을 간단히 구현해준다.</p>

<p><br /></p>

<blockquote>
  <p><strong>Post.java</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@RedisHash</span><span class="o">(</span><span class="s">"post"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="o">{</span>

    <span class="nd">@Id</span> <span class="nd">@Indexed</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<p>Repository도 간단히 구현해준다.</p>

<blockquote>
  <p><strong>PostRedisRepository</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PostRedisRepository</span> <span class="kd">extends</span> <span class="nc">CrudRepository</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<p>이제 Redis를 연결하기 위한 Config파일을 생성해준다. (기존의 DB에 연결하기 위해서 사용했던 Datasource와 비슷한 역할을 한다.)</p>

<blockquote>
  <p><strong>RedisConfig</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableRedisRepositories</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisConfig</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.host}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">redisHost</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">redisPort</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RedisConnectionFactory</span> <span class="nf">redisConnectionFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">LettuceConnectionFactory</span><span class="o">(</span><span class="n">redisHost</span><span class="o">,</span> <span class="n">redisPort</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RedisTemplate</span><span class="o">&lt;?,</span> <span class="o">?&gt;</span> <span class="n">redisTemplate</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">RedisTemplate</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">redisTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisTemplate</span><span class="o">&lt;&gt;();</span>
        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">redisConnectionFactory</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">RedisConnectionFactory</code>를 이용하여 내장 혹은 외부 Redis에 연결한다.</li>
  <li><code class="language-plaintext highlighter-rouge">RedisTemplate</code>은 <code class="language-plaintext highlighter-rouge">RedisConnection</code>에서 넘겨준 byte 값을 객체 직렬화한다.</li>
</ul>

<p><br /></p>

<p>마지막으로 설정 파일을 추가해준다.</p>

<blockquote>
  <p><strong>application-test.yml</strong></p>
</blockquote>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">6379</span>
</code></pre></div></div>
<blockquote>
  <p>test 환경에서만 실행할 것이기 때문에 위와 같이 해두었다. 만약 다른 환경에서도 필요하다면 profile 설정을 해주면 된다.</p>
</blockquote>

<p><br /></p>

<h1 id="내장-redis-port-수동-설정">내장 Redis port 수동 설정</h1>

<p>이제 Redis를 사용하기 위한 설정은 모두 되었다.</p>

<p>본격적으로 Embedded-Redis Server를 실행만 해주면 된다.</p>

<p>기본적으로 Embedded-Redis Server를 실행시키면 localhost(127.0.0.1)에 실행된다.</p>

<p>이제 Embedded-Redis Server 설정을 해준다.</p>

<blockquote>
  <p><strong>EmbeddedRedisConfig</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@Profile</span><span class="o">(</span><span class="s">"!prod"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmbeddedRedisConfig</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">redisPort</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">RedisServer</span> <span class="n">redisServer</span><span class="o">;</span>

    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">redisServer</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="n">redisPort</span><span class="o">);</span>
        <span class="n">redisServer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@PreDestroy</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopRedis</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">redisServer</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">redisServer</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">redisServer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>설정 파일에서 받아온 port를 이용하여 내장 Redis 서버를 작동시킨다.
    <ul>
      <li><strong>이때 <code class="language-plaintext highlighter-rouge">RedisConfig</code>에서 바라보는 host, port랑 내장 Redis 서버가 켜진 port랑 다르면 에러가 발생한다.</strong></li>
      <li><strong>필자는 이 부분 때문에 삽질을 굉장히 오래했다. 이런xx</strong></li>
    </ul>
  </li>
  <li>빈 스코프
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@PostConstruct</code>: 객체의 초기화 부분 -&gt; 객체가 생성된 후 별도의 초기화 작업을 위해 실행하는 메서드를 선언한다.</li>
      <li><code class="language-plaintext highlighter-rouge">@PreDestroy</code>: 마지막 소멸 단계 -&gt; 빈 컨테이너에서 빈을 제거하기 전에 해야할 작업을 이곳에 정의한다.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<p>간단히 테스트 코드를 작성하고 테스트해본다.</p>

<blockquote>
  <p><strong>PostRedisRepositoryTest</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Import</span><span class="o">({</span><span class="nc">EmbeddedRedisConfig</span><span class="o">.</span><span class="na">class</span><span class="o">})</span> <span class="c1">// @DataRedisTest를 사용하면 Config를 읽지 못하므로 추가</span>
<span class="nd">@DataRedisTest</span> 
<span class="nd">@DirtiesContext</span><span class="o">(</span><span class="n">classMode</span> <span class="o">=</span> <span class="nc">ClassMode</span><span class="o">.</span><span class="na">BEFORE_EACH_TEST_METHOD</span><span class="o">)</span> <span class="c1">// 반복 테스트할 때 매번 새로운 컨텍스트를 띄우기 위함</span>
<span class="nd">@ActiveProfiles</span><span class="o">(</span><span class="s">"test"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">PostRedisRepositoryTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">PostRedisRepository</span> <span class="n">postRedisRepository</span><span class="o">;</span>

    <span class="nd">@AfterEach</span>
    <span class="kt">void</span> <span class="nf">tearDown</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@RepeatedTest</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">20</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">save_and_find</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// given</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Post</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="s">"post"</span><span class="o">,</span> <span class="s">"post content"</span><span class="o">);</span>

        <span class="c1">// when</span>
        <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>

        <span class="c1">// then</span>
        <span class="nc">Post</span> <span class="n">findPost</span> <span class="o">=</span> <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span>
            <span class="o">.</span><span class="na">orElseThrow</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getId</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">findPost</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">findPost</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getContent</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">findPost</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@RepeatedTest</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">20</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">update_and_find</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// given</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Post</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="s">"post"</span><span class="o">,</span> <span class="s">"post content"</span><span class="o">);</span>
        <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>

        <span class="c1">// when</span>
        <span class="nc">Post</span> <span class="n">savedPost</span> <span class="o">=</span> <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orElseThrow</span><span class="o">();</span>
        <span class="n">savedPost</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"updated post"</span><span class="o">);</span>
        <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">savedPost</span><span class="o">);</span>

        <span class="c1">// then</span>
        <span class="nc">Post</span> <span class="n">updatedPost</span> <span class="o">=</span> <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orElseThrow</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">updatedPost</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"updated post"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p align="center"><img src="../assets/img/binghe/21-10-19-embedded-redis-server/embedded_config_result.png" /> </p>

<p>20번을 돌려도 문제없이 조회, 수정등의 테스트가 통과하는 것을 볼 수 있다.</p>

<p><br /></p>

<h1 id="내장-redis-port-자동-설정">내장 Redis port 자동 설정</h1>
<blockquote>
  <p>자동으로 port를 찾아 설정해준다는 의미로 동적이라고 하였습니다!</p>
</blockquote>

<p>위에서 학습 테스트한 방식의 문제점은 <strong>통합 테스트시 여러 내장 Redis를 작동시킬 일이 있으면 port가 충돌한다는 것이다.</strong></p>

<p>그러므로, 이미 사용중인 port라면 다른 port를 사용할 필요가 있다.</p>

<p>그렇다면 특정 port가 사용중인지 아닌지 확인하는 방법은 무엇일까?</p>

<p>정답은 <strong>쉘을 사용하여 <code class="language-plaintext highlighter-rouge">netstat</code>명령어를 실행시켜 확인하는 것이다.</strong></p>

<p><code class="language-plaintext highlighter-rouge">netstat -nat | grep LISTEN | grep {port}</code></p>

<p><br /></p>

<p>자바에선 현재 실행중인 환경과의 인터페이스인 <code class="language-plaintext highlighter-rouge">Runtime</code> 객체를 제공한다.</p>

<blockquote>
  <p>ShellTest</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShellTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">shellTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">// port</span>
        <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">22</span><span class="o">;</span>

        <span class="c1">// netstat</span>
        <span class="nc">String</span> <span class="n">command</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"netstat -nat | grep LISTEN | grep %d"</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">shell</span> <span class="o">=</span> <span class="o">{</span><span class="s">"/bin/sh"</span><span class="o">,</span> <span class="s">"-c"</span><span class="o">,</span> <span class="n">command</span><span class="o">};</span>
        <span class="nc">Process</span> <span class="n">process</span> <span class="o">=</span> <span class="nc">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">shell</span><span class="o">);</span>

        <span class="c1">// InputStream을 통해 읽기</span>
        <span class="nc">String</span> <span class="n">line</span><span class="o">;</span>
        <span class="nc">StringBuilder</span> <span class="n">pidInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">BufferedReader</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">process</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())))</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">pidInfo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">pidInfo</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>위 코드를 실행해서 만약 연결된 <strong>port가 있다면 아래와 같이 pidInfo가 뜬다.</strong></p>

<p align="center"><img src="../assets/img/binghe/21-10-19-embedded-redis-server/find_port_result_true.png" /></p>

<p>반면에, 아무런 port도 연결되어 있지 않다면 아무 문자열로 뜨지 않는다. (<code class="language-plaintext highlighter-rouge">isEmpty()</code>)</p>

<p><br /></p>

<p>이를 사용해서 port를 찾고 연결하는 과정을 자동화 시키면 된다.</p>

<blockquote>
  <p><strong>수정된 EmbeddedRedisConfig</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@Profile</span><span class="o">(</span><span class="s">"!prod"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmbeddedRedisConfig</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">BIN_SH</span> <span class="o">=</span> <span class="s">"/bin/sh"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">BIN_SH_OPTION</span> <span class="o">=</span> <span class="s">"-c"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">COMMAND</span> <span class="o">=</span> <span class="s">"netstat -nat | grep LISTEN|grep %d"</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">redisPort</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">RedisServer</span> <span class="n">redisServer</span><span class="o">;</span>

    <span class="c1">// 아래처럼 빈을 꼭 여기서 등록해줘야 한다.</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RedisConnectionFactory</span> <span class="nf">redisConnectionFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">LettuceConnectionFactory</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="n">redisPort</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">redisServer</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="n">isRedisRunning</span><span class="o">()</span> <span class="o">?</span> <span class="n">findAvailablePort</span><span class="o">()</span> <span class="o">:</span> <span class="n">redisPort</span><span class="o">;</span>
        <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="n">port</span><span class="o">);</span>
        <span class="n">redisServer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@PreDestroy</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopRedis</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">redisServer</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">redisServer</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">redisServer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isRedisRunning</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">isRunning</span><span class="o">(</span><span class="n">executeGrepProcessCommand</span><span class="o">(</span><span class="n">redisPort</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isRunning</span><span class="o">(</span><span class="nc">Process</span> <span class="n">process</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">line</span><span class="o">;</span>
        <span class="nc">StringBuilder</span> <span class="n">pidInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">BufferedReader</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">process</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())))</span> <span class="o">{</span>

            <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">pidInfo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
            <span class="o">}</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="o">!</span><span class="n">pidInfo</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Process</span> <span class="nf">executeGrepProcessCommand</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">command</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="no">COMMAND</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">shell</span> <span class="o">=</span> <span class="o">{</span><span class="no">BIN_SH</span><span class="o">,</span> <span class="no">BIN_SH_OPTION</span><span class="o">,</span> <span class="n">command</span><span class="o">};</span>
        <span class="k">return</span> <span class="nc">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">shell</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">findAvailablePort</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">10000</span><span class="o">;</span> <span class="n">port</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="o">;</span> <span class="n">port</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">Process</span> <span class="n">process</span> <span class="o">=</span> <span class="n">executeGrepProcessCommand</span><span class="o">(</span><span class="n">port</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">isRunning</span><span class="o">(</span><span class="n">process</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">port</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Not Found Available port: 10000 ~ 65535"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>어렵게 생각할 필요없다. 그저 기존의 설정 파일에 설정된 port가 이미 사용중이라면 10000부터 차례대로 port를 설정하여 가져오는 것이다.</p>

<p><strong>여기서 가장 중요한 개념은 <code class="language-plaintext highlighter-rouge">RedisConfig</code>에서 바라보는 port와 내장 Redis 서버의 port가 같아야한다는 점이다!</strong></p>

<p>그러므로, <code class="language-plaintext highlighter-rouge">RedisConfig</code>의 코드도 수정해줘야한다.</p>

<p><br /></p>

<blockquote>
  <p><strong>RedisConfig</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableRedisRepositories</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisConfig</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.host}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">redisHost</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">redisPort</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="nc">RedisConnectionFactory</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// 수정된 부분!</span>
    <span class="kd">public</span> <span class="nc">RedisConnectionFactory</span> <span class="nf">redisConnectionFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">LettuceConnectionFactory</span><span class="o">(</span><span class="n">redisHost</span><span class="o">,</span> <span class="n">redisPort</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RedisTemplate</span><span class="o">&lt;?,</span> <span class="o">?&gt;</span> <span class="n">redisTemplate</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">RedisTemplate</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">redisTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisTemplate</span><span class="o">&lt;&gt;();</span>
        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">redisConnectionFactory</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>그렇다면 어떻게 <strong>내장 Redis 서버를 사용하는 환경과 외장 Redis 서버를 사용하는 환경을 분리할까?</strong></p>

<p><strong>바로 <code class="language-plaintext highlighter-rouge">@ConditionalOnMissingBean</code>을 사용하는 것이다.</strong></p>

<p><strong>이 애노테이션은 기존에 같은 빈이 등록되어 있으면 해당 메서드의 빈은 등록하지 않는 기능을 제공한다.</strong></p>

<p>마지막으로 기존의 테스트를 돌려보면 정상 통과한다. 이외에도 통합 테스트시 여러 대의 내장 Redis 서버를 켜도 문제 없이 실행된다.</p>

<p><br /></p>

<h1 id="사용시-주의할-점---중요">사용시 주의할 점 - 중요</h1>
<p>내장 Redis를 사용하며 겪었던 경험과 주의할 점을 이곳에 남겨둔다. (부들부들 😠)</p>

<p><br /></p>

<h2 id="메모리-확인">메모리 확인</h2>
<p>내장 Redis Server도 메모리에 올라간다.</p>

<p>그리고 테스트시 많은 내장 Redis Server를 키다보면, 메모리 부족이 발생할 수 있다.</p>

<p>이럴 경우 Redis 설정에서 메모리 설정을 해주면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostConstruct</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">redisServer</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">redisPort</span> <span class="o">=</span> <span class="n">isRedisRunning</span><span class="o">()</span> <span class="o">?</span> <span class="n">findAvailablePort</span><span class="o">()</span> <span class="o">:</span> <span class="n">port</span><span class="o">;</span>
    <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="n">redisPort</span><span class="o">);</span>
    <span class="n">redisServer</span> <span class="o">=</span> <span class="nc">RedisServer</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">port</span><span class="o">(</span><span class="n">redisPort</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setting</span><span class="o">(</span><span class="s">"maxmemory 128M"</span><span class="o">)</span> <span class="c1">//maxheap 128M</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="n">redisServer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Redis에 저장되는 데이터의 용량이 128M가 넘어가면, 기존의 데이터를 덮어씌우는 방식으로 일정 메모리 이상 차지하지 못하게 한다.</p>

<p><br /></p>

<h2 id="netstat-확인">netstat 확인</h2>

<p>만약 두번째 방법인 <a href="#내장-redis-port-자동-설정">내장 Redis port 자동 설정</a>를 사용한다면, 해당 코드가 어느 환경에서 도는지 확인해야한다.</p>

<p>필자는 프로젝트를 하며 내장 Redis를 구현하여 사용하던중, 젠킨스에서만 계속해서 예외가 발생했다.</p>

<p>4시간동안의 삽질 끝에 찾은 문제는 도커 컨테이너안에 <code class="language-plaintext highlighter-rouge">netstat</code> 명령어가 <code class="language-plaintext highlighter-rouge">not found</code>였기 때문이다…</p>

<p>해당 컨테이너안에 <code class="language-plaintext highlighter-rouge">net-tools</code>를 설치했더니 잘 동작한다..</p>

<p><br /></p>

<p><strong>내장 Redis 서버를 사용하려면 우선 포트를 조심하고, 두 번째는 해당 프로그램이 돌아가는 환경에 <code class="language-plaintext highlighter-rouge">net-tools</code>가 존재하는지 확인하자.</strong>
<br /></p>

<h2 id="m1">M1</h2>

<p>M1 환경에서 Redis 내장 서버를 시동시키면 아래와 같은 메시지가 뜬다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">RuntimeException</span><span class="o">:</span> <span class="nc">Can</span><span class="err">'</span><span class="n">t</span> <span class="n">start</span> <span class="n">redis</span> <span class="n">server</span><span class="o">.</span> <span class="nc">Check</span> <span class="n">logs</span> <span class="k">for</span> <span class="n">details</span><span class="o">.</span>
</code></pre></div></div>

<p>원인은 내장 Redis 라이브러리에 <code class="language-plaintext highlighter-rouge">mac_arm64</code>용 바이너리가 준비되어 있지 않아서 그렇다.</p>

<p><br /></p>

<p>우선 <a href="https://redis.io/download">Redis 소스 코드</a>를 다운받아 컴파일하면, Redis Server 컴파일 파일이 생긴다.</p>

<p>해당 파일을 프로젝트의 resources 디렉터리에 복사하고, ClassPathResource 로 불러오시면 된다.</p>

<p align="center"><img src="../assets/img/binghe/21-10-19-embedded-redis-server/m1_issue.png" width="400" /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">redisServer</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">URISyntaxException</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">redisPort</span> <span class="o">=</span> <span class="n">isRedisRunning</span><span class="o">()</span> <span class="o">?</span> <span class="n">findAvailablePort</span><span class="o">()</span> <span class="o">:</span> <span class="n">port</span><span class="o">;</span>
  <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="n">redisPort</span><span class="o">);</span>

  <span class="k">if</span> <span class="o">(</span><span class="n">isArmMac</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">getRedisFileForArcMac</span><span class="o">()),</span>
                                  <span class="n">redisPort</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(!</span><span class="n">isArmMac</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="n">redisPort</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="n">redisServer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isArmMac</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"os.arch"</span><span class="o">),</span> <span class="s">"aarch64"</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
    <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"os.name"</span><span class="o">),</span> <span class="s">"Mac OS X"</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="nc">File</span> <span class="nf">getRedisFileForArcMac</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">ClassPathResource</span><span class="o">(</span><span class="s">"binary/redis/redis-server-6.2.5-mac-arm64"</span><span class="o">).</span><span class="na">getFile</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmbeddedRedisServerException</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p><a href="https://github.com/woowacourse-teams/2021-pick-git/pull/576">M1 Embedded Redis 문제 해결 PR - by 다니</a>에서 전체 코드를 확인할 수 있다.</p>
</blockquote>

<p><br /></p>

<h1 id="마치며">마치며</h1>
<p>처음엔 내장 Redis Server를 어떻게 구축해야하나 막막했었다… 그래도 <a href="https://jojoldu.tistory.com/297">이동욱님의 글</a>를 보고 많은 도움을 받았다.</p>

<p>다만 생각보단 추상적인 부분이 많아 삽질을 많이 하게되었다.</p>

<p>실제 프로젝트에 적용시켰을 때 많은 문제가 야기되었고, 이번 글을 쓰게 된 계기가 되었다.</p>

<p>쨋든! 굉장히 좋은 지식을 얻어간다.</p>

<p>현재는 토큰과 캐시 데이터를 저장하는 용도로만 Redis를 사용하지만, 메시지 큐와 같은 기능을 사용할 때 Redis를 사용하기에 내장 Redis 서버가 유용하게 사용될 듯하다.</p>

<p><br /></p>

<h1 id="참고">참고</h1>

<ul>
  <li>https://jojoldu.tistory.com/297</li>
  <li>https://www.baeldung.com/spring-embedded-redis</li>
  <li>http://arahansa.github.io/docs_spring/redis.html</li>
  <li>https://velog.io/@hakjong/ARM-Mac-M1-%EC%97%90%EC%84%9C-embedded-redis-%EC%82%AC%EC%9A%A9</li>
</ul>

      <div class="page-footer">
        <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=내장 Redis 설정기&url=https://2021-pick-git.github.io//embedded-redis-server/" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=https://2021-pick-git.github.io//embedded-redis-server/" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=https://2021-pick-git.github.io//embedded-redis-server/" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div>
        <div class="page-tag">
          
            <a href="/tags#백엔드" class="tag">&#35; 백엔드</a>
          
            <a href="/tags#Redis" class="tag">&#35; Redis</a>
          
            <a href="/tags#Embedded" class="tag">&#35; Embedded</a>
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->

  <script src="https://utteranc.es/client.js"
        repo="2021-pick-git/pick-git-comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
</article> <!-- End Article Page -->

</div>

  </div>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
