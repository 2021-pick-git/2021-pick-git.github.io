<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>ë‚´ì¥ Redis ì„¤ì •ê¸° - BingheCompany ğŸ‡°ğŸ‡·</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="BingheCompany ğŸ‡°ğŸ‡·" property="og:site_name">
  
    <meta content="ë‚´ì¥ Redis ì„¤ì •ê¸°" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="ë‚´ì¥ Redis ì„¤ì •ê¸°" property="og:description">
  
  
    <meta content="https://2021-pick-git.github.io//embedded-redis-server/" property="og:url">
  
  
    <meta content="2021-10-19T15:00:00+09:00" property="article:published_time">
    <meta content="https://2021-pick-git.github.io//about/" property="article:author">
  
  
    <meta content="https://2021-pick-git.github.io//assets/img/redis_icon.png" property="og:image">
  
  
    
  
  
    
    <meta content="ë°±ì—”ë“œ" property="article:tag">
    
    <meta content="Redis" property="article:tag">
    
    <meta content="Embedded" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
  
    <meta name="twitter:title" content="ë‚´ì¥ Redis ì„¤ì •ê¸°">
  
  
    <meta name="twitter:url" content="https://2021-pick-git.github.io//embedded-redis-server/">
  
  
    <meta name="twitter:description" content="ë‚´ì¥ Redis ì„¤ì •ê¸°">
  
  
    <meta name="twitter:image:src" content="https://2021-pick-git.github.io//assets/img/redis_icon.png">
  

	<meta name="description" content="ë‚´ì¥ Redis ì„¤ì •ê¸°">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700|Lato:300,400,700&display=swap" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>

  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/"><img src="/assets/img/mark.jpg" alt="ê¹ƒ-ë“¤ë‹¤ (pick-git)"></a>
      </div>
      <div class="author-name">ê¹ƒ-ë“¤ë‹¤ (pick-git)</div>
      <p>ê¹ƒ-ë“¤ë‹¤ ê¸°ìˆ  ë¸”ë¡œê·¸ì…ë‹ˆë‹¤.</br>ğŸ˜‡ğŸ’ª</br> This is a tech blog for pick-git.</br> ãƒ”ã‚¯ã‚®ãƒˆã®æŠ€è¡“ã®blogã§ã™ã€‚</br> è¿™æ˜¯ pick-git ç§‘æŠ€åšå®¢.</br></p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Contact me</h3>
      <ul>
        <!-- 
          <li><a href="https://twitter.com/artemsheludko_" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        
        
          <li><a href="https://facebook.com/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
         -->
        
          <li class="github"><a href="http://github.com/woowacourse-teams/2021-pick-git" target="_blank"><i class="fa fa-github"></i></a></li>
        
        <!-- 
          <li class="linkedin"><a href="https://in.linkedin.com/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
        
        
          <li class="email"><a href="mailto:example.david@blog.com"><i class="fa fa-envelope-o" aria-hidden="true"></i></a></li>
         -->
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2021 &copy; ê¹ƒ-ë“¤ë‹¤ (pick-git)</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    <div class="page-cover-image">
      <figure>
        <img class="page-image" src=/assets/img/redis_icon.png alt="ë‚´ì¥ Redis ì„¤ì •ê¸°">
        
      </figure>
    </div> <!-- End Page Cover Image -->
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">ë‚´ì¥ Redis ì„¤ì •ê¸°</h1>
        <div class="page-date"><span>2021, Oct 19&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <p>ì•ˆë…•í•˜ì„¸ìš” :) ë§ˆí¬ì…ë‹ˆë‹¤!</p>

<h1 id="ëª©ì°¨">ëª©ì°¨</h1>

<p><br /></p>

<ul>
  <li><a href="#ëª©ì°¨">ëª©ì°¨</a></li>
  <li><a href="#ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</a></li>
  <li><a href="#í…ŒìŠ¤íŠ¸-í™˜ê²½-êµ¬ì¶•">í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•</a>
    <ul>
      <li><a href="#ì˜ì¡´ì„±">ì˜ì¡´ì„±</a></li>
      <li><a href="#í…ŒìŠ¤íŠ¸-ë„ë©”ì¸-ìƒì„±">í…ŒìŠ¤íŠ¸ ë„ë©”ì¸ ìƒì„±</a></li>
    </ul>
  </li>
  <li><a href="#ë‚´ì¥-redis-port-ìˆ˜ë™-ì„¤ì •">ë‚´ì¥ Redis port ìˆ˜ë™ ì„¤ì •</a></li>
  <li><a href="#ë‚´ì¥-redis-port-ìë™-ì„¤ì •">ë‚´ì¥ Redis port ìë™ ì„¤ì •</a></li>
  <li><a href="#ì‚¬ìš©ì‹œ-ì£¼ì˜í• -ì ---ì¤‘ìš”">ì‚¬ìš©ì‹œ ì£¼ì˜í•  ì  - ì¤‘ìš”</a>
    <ul>
      <li><a href="#ë©”ëª¨ë¦¬-í™•ì¸">ë©”ëª¨ë¦¬ í™•ì¸</a></li>
      <li><a href="#netstat-í™•ì¸">netstat í™•ì¸</a></li>
      <li><a href="#m1">M1</a></li>
    </ul>
  </li>
  <li><a href="#ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</a></li>
  <li><a href="#ì°¸ê³ ">ì°¸ê³ </a></li>
</ul>

<p><br /></p>

<h1 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h1>

<p>í† í°ê³¼ ìºì‹± ê°œë°œ ì´ˆê¸°ì—” ë‚´ì¥ Redisê°€ ì¡´ì¬í•˜ëŠ”ì§€ ëª¨ë¥´ê³ , RedisRepository ì—­í• ì„ í•˜ëŠ” ê°ì²´ë¥¼ ì§ì ‘ ìë°” ì½”ë“œë¡œ êµ¬í˜„í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆë‹¤.</p>

<p>ì¦‰, Fake ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ íƒí–ˆë‹¤.</p>

<p>ì´ë ‡ê²Œ í…ŒìŠ¤íŠ¸ í•˜ëŠ” ê²ƒì˜ ê°€ì¥ í° ë¬¸ì œëŠ” ì‹¤ì œ Redis í™˜ê²½ì´ ì•„ë‹ˆë€ ì ì´ë‹¤..</p>

<p>ê·¸ë˜ì„œ Embedded H2ì²˜ëŸ¼ Embedded Redisë„ ìˆë‹¤ ì°¾ì•„ë´¤ê³ , ì ìš©ì‹œí‚¤ëŠ” ì‹œì ì—ì„œ ëª¨ë¥´ëŠ” ê²ƒì´ ë§ì•„ ì‚½ì§ˆì„ í†µí•´ ë§ì€ ê²ƒì„ ë°°ìš¸ ìˆ˜ ìˆì—ˆê³ , ì´ì°¸ì— ì •ë¦¬í•˜ê²Œ ë˜ì—ˆë‹¤.</p>

<p><br /></p>

<blockquote>
  <p>ë³¸ ê¸€ì€ <a href="https://jojoldu.tistory.com/297">ì´ë™ìš±ë‹˜ì˜ - [Redis] SpringBoot Data Redis ë¡œì»¬/í†µí•© í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•í•˜ê¸°</a>ì™€</p>

  <p>ì•„ë¼í•œì‚¬ë‹˜ê»˜ì„œ ë²ˆì—­í•˜ì‹  <a href="http://arahansa.github.io/docs_spring/redis.html">ìŠ¤í”„ë§ ë°ì´í„° ë ˆë””ìŠ¤</a> ë¥¼ ì°¸ê³ í•˜ì—¬ ì‘ì„±ëœ ê¸€ì…ë‹ˆë‹¤.</p>
</blockquote>

<p><br /></p>

<h1 id="í…ŒìŠ¤íŠ¸-í™˜ê²½-êµ¬ì¶•">í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•</h1>

<p><br /></p>

<h2 id="ì˜ì¡´ì„±">ì˜ì¡´ì„±</h2>
<p>ë¨¼ì € ì˜ì¡´ì„±ì„ ì£¼ì…í•´ì¤€ë‹¤.</p>
<pre><code class="language-build.gradle">implementation group: 'org.springframework.boot', name: 'spring-boot-starter-data-redis', version: '2.5.4'
implementation (group: 'it.ozimov', name: 'embedded-redis', version: '0.7.3') {
    exclude group: 'org.slf4j', module: 'slf4j-simple'
}
</code></pre>
<ul>
  <li>Spring Data Redis
    <ul>
      <li>Spring Data JPAì²˜ëŸ¼ Redisë¥¼ JPA Repository ì‚¬ìš©í•˜ë“¯ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ëª¨ë“ˆ.</li>
    </ul>
  </li>
  <li>embedded-redis
    <ul>
      <li>ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">it.ozimov.embedded-redis</code>ì•ˆì— <code class="language-plaintext highlighter-rouge">slf4j-simple</code>ì´ ë‚´ì¥ë˜ì–´ ìˆì–´ì„œ, í•„ìëŠ” slf4jì— ëŒ€í•œ ì¶©ëŒì´ ë°œìƒí•˜ì˜€ë‹¤. ê·¸ë˜ì„œ ì´ë¥¼ ì œì™¸ì‹œì¼°ë‹¤.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="í…ŒìŠ¤íŠ¸-ë„ë©”ì¸-ìƒì„±">í…ŒìŠ¤íŠ¸ ë„ë©”ì¸ ìƒì„±</h2>
<p>í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë„ë©”ì¸ì„ ê°„ë‹¨íˆ êµ¬í˜„í•´ì¤€ë‹¤.</p>

<p><br /></p>

<blockquote>
  <p><strong>Post.java</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@RedisHash</span><span class="o">(</span><span class="s">"post"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="o">{</span>

    <span class="nd">@Id</span> <span class="nd">@Indexed</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<p>Repositoryë„ ê°„ë‹¨íˆ êµ¬í˜„í•´ì¤€ë‹¤.</p>

<blockquote>
  <p><strong>PostRedisRepository</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PostRedisRepository</span> <span class="kd">extends</span> <span class="nc">CrudRepository</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<p>ì´ì œ Redisë¥¼ ì—°ê²°í•˜ê¸° ìœ„í•œ ConfigíŒŒì¼ì„ ìƒì„±í•´ì¤€ë‹¤. (ê¸°ì¡´ì˜ DBì— ì—°ê²°í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í–ˆë˜ Datasourceì™€ ë¹„ìŠ·í•œ ì—­í• ì„ í•œë‹¤.)</p>

<blockquote>
  <p><strong>RedisConfig</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableRedisRepositories</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisConfig</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.host}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">redisHost</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">redisPort</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RedisConnectionFactory</span> <span class="nf">redisConnectionFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">LettuceConnectionFactory</span><span class="o">(</span><span class="n">redisHost</span><span class="o">,</span> <span class="n">redisPort</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RedisTemplate</span><span class="o">&lt;?,</span> <span class="o">?&gt;</span> <span class="n">redisTemplate</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">RedisTemplate</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">redisTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisTemplate</span><span class="o">&lt;&gt;();</span>
        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">redisConnectionFactory</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">RedisConnectionFactory</code>ë¥¼ ì´ìš©í•˜ì—¬ ë‚´ì¥ í˜¹ì€ ì™¸ë¶€ Redisì— ì—°ê²°í•œë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">RedisTemplate</code>ì€ <code class="language-plaintext highlighter-rouge">RedisConnection</code>ì—ì„œ ë„˜ê²¨ì¤€ byte ê°’ì„ ê°ì²´ ì§ë ¬í™”í•œë‹¤.</li>
</ul>

<p><br /></p>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì„¤ì • íŒŒì¼ì„ ì¶”ê°€í•´ì¤€ë‹¤.</p>

<blockquote>
  <p><strong>application-test.yml</strong></p>
</blockquote>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">6379</span>
</code></pre></div></div>
<blockquote>
  <p>test í™˜ê²½ì—ì„œë§Œ ì‹¤í–‰í•  ê²ƒì´ê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì´ í•´ë‘ì—ˆë‹¤. ë§Œì•½ ë‹¤ë¥¸ í™˜ê²½ì—ì„œë„ í•„ìš”í•˜ë‹¤ë©´ profile ì„¤ì •ì„ í•´ì£¼ë©´ ëœë‹¤.</p>
</blockquote>

<p><br /></p>

<h1 id="ë‚´ì¥-redis-port-ìˆ˜ë™-ì„¤ì •">ë‚´ì¥ Redis port ìˆ˜ë™ ì„¤ì •</h1>

<p>ì´ì œ Redisë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì„¤ì •ì€ ëª¨ë‘ ë˜ì—ˆë‹¤.</p>

<p>ë³¸ê²©ì ìœ¼ë¡œ Embedded-Redis Serverë¥¼ ì‹¤í–‰ë§Œ í•´ì£¼ë©´ ëœë‹¤.</p>

<p>ê¸°ë³¸ì ìœ¼ë¡œ Embedded-Redis Serverë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ localhost(127.0.0.1)ì— ì‹¤í–‰ëœë‹¤.</p>

<p>ì´ì œ Embedded-Redis Server ì„¤ì •ì„ í•´ì¤€ë‹¤.</p>

<blockquote>
  <p><strong>EmbeddedRedisConfig</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@Profile</span><span class="o">(</span><span class="s">"!prod"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmbeddedRedisConfig</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">redisPort</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">RedisServer</span> <span class="n">redisServer</span><span class="o">;</span>

    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">redisServer</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="n">redisPort</span><span class="o">);</span>
        <span class="n">redisServer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@PreDestroy</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopRedis</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">redisServer</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">redisServer</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">redisServer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>ì„¤ì • íŒŒì¼ì—ì„œ ë°›ì•„ì˜¨ portë¥¼ ì´ìš©í•˜ì—¬ ë‚´ì¥ Redis ì„œë²„ë¥¼ ì‘ë™ì‹œí‚¨ë‹¤.
    <ul>
      <li><strong>ì´ë•Œ <code class="language-plaintext highlighter-rouge">RedisConfig</code>ì—ì„œ ë°”ë¼ë³´ëŠ” host, portë‘ ë‚´ì¥ Redis ì„œë²„ê°€ ì¼œì§„ portë‘ ë‹¤ë¥´ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.</strong></li>
      <li><strong>í•„ìëŠ” ì´ ë¶€ë¶„ ë•Œë¬¸ì— ì‚½ì§ˆì„ êµ‰ì¥íˆ ì˜¤ë˜í–ˆë‹¤. ì´ëŸ°xx</strong></li>
    </ul>
  </li>
  <li>ë¹ˆ ìŠ¤ì½”í”„
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@PostConstruct</code>: ê°ì²´ì˜ ì´ˆê¸°í™” ë¶€ë¶„ -&gt; ê°ì²´ê°€ ìƒì„±ëœ í›„ ë³„ë„ì˜ ì´ˆê¸°í™” ì‘ì—…ì„ ìœ„í•´ ì‹¤í–‰í•˜ëŠ” ë©”ì„œë“œë¥¼ ì„ ì–¸í•œë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">@PreDestroy</code>: ë§ˆì§€ë§‰ ì†Œë©¸ ë‹¨ê³„ -&gt; ë¹ˆ ì»¨í…Œì´ë„ˆì—ì„œ ë¹ˆì„ ì œê±°í•˜ê¸° ì „ì— í•´ì•¼í•  ì‘ì—…ì„ ì´ê³³ì— ì •ì˜í•œë‹¤.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<p>ê°„ë‹¨íˆ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  í…ŒìŠ¤íŠ¸í•´ë³¸ë‹¤.</p>

<blockquote>
  <p><strong>PostRedisRepositoryTest</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Import</span><span class="o">({</span><span class="nc">EmbeddedRedisConfig</span><span class="o">.</span><span class="na">class</span><span class="o">})</span> <span class="c1">// @DataRedisTestë¥¼ ì‚¬ìš©í•˜ë©´ Configë¥¼ ì½ì§€ ëª»í•˜ë¯€ë¡œ ì¶”ê°€</span>
<span class="nd">@DataRedisTest</span> 
<span class="nd">@DirtiesContext</span><span class="o">(</span><span class="n">classMode</span> <span class="o">=</span> <span class="nc">ClassMode</span><span class="o">.</span><span class="na">BEFORE_EACH_TEST_METHOD</span><span class="o">)</span> <span class="c1">// ë°˜ë³µ í…ŒìŠ¤íŠ¸í•  ë•Œ ë§¤ë²ˆ ìƒˆë¡œìš´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë„ìš°ê¸° ìœ„í•¨</span>
<span class="nd">@ActiveProfiles</span><span class="o">(</span><span class="s">"test"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">PostRedisRepositoryTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">PostRedisRepository</span> <span class="n">postRedisRepository</span><span class="o">;</span>

    <span class="nd">@AfterEach</span>
    <span class="kt">void</span> <span class="nf">tearDown</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@RepeatedTest</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">20</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">save_and_find</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// given</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Post</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="s">"post"</span><span class="o">,</span> <span class="s">"post content"</span><span class="o">);</span>

        <span class="c1">// when</span>
        <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>

        <span class="c1">// then</span>
        <span class="nc">Post</span> <span class="n">findPost</span> <span class="o">=</span> <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span>
            <span class="o">.</span><span class="na">orElseThrow</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getId</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">findPost</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">findPost</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getContent</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">findPost</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@RepeatedTest</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">20</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">update_and_find</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// given</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Post</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="s">"post"</span><span class="o">,</span> <span class="s">"post content"</span><span class="o">);</span>
        <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>

        <span class="c1">// when</span>
        <span class="nc">Post</span> <span class="n">savedPost</span> <span class="o">=</span> <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orElseThrow</span><span class="o">();</span>
        <span class="n">savedPost</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"updated post"</span><span class="o">);</span>
        <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">savedPost</span><span class="o">);</span>

        <span class="c1">// then</span>
        <span class="nc">Post</span> <span class="n">updatedPost</span> <span class="o">=</span> <span class="n">postRedisRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orElseThrow</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">updatedPost</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"updated post"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p align="center"><img src="../assets/img/binghe/21-10-19-embedded-redis-server/embedded_config_result.png" /> </p>

<p>20ë²ˆì„ ëŒë ¤ë„ ë¬¸ì œì—†ì´ ì¡°íšŒ, ìˆ˜ì •ë“±ì˜ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<h1 id="ë‚´ì¥-redis-port-ìë™-ì„¤ì •">ë‚´ì¥ Redis port ìë™ ì„¤ì •</h1>
<blockquote>
  <p>ìë™ìœ¼ë¡œ portë¥¼ ì°¾ì•„ ì„¤ì •í•´ì¤€ë‹¤ëŠ” ì˜ë¯¸ë¡œ ë™ì ì´ë¼ê³  í•˜ì˜€ìŠµë‹ˆë‹¤!</p>
</blockquote>

<p>ìœ„ì—ì„œ í•™ìŠµ í…ŒìŠ¤íŠ¸í•œ ë°©ì‹ì˜ ë¬¸ì œì ì€ <strong>í†µí•© í…ŒìŠ¤íŠ¸ì‹œ ì—¬ëŸ¬ ë‚´ì¥ Redisë¥¼ ì‘ë™ì‹œí‚¬ ì¼ì´ ìˆìœ¼ë©´ portê°€ ì¶©ëŒí•œë‹¤ëŠ” ê²ƒì´ë‹¤.</strong></p>

<p>ê·¸ëŸ¬ë¯€ë¡œ, ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ portë¼ë©´ ë‹¤ë¥¸ portë¥¼ ì‚¬ìš©í•  í•„ìš”ê°€ ìˆë‹¤.</p>

<p>ê·¸ë ‡ë‹¤ë©´ íŠ¹ì • portê°€ ì‚¬ìš©ì¤‘ì¸ì§€ ì•„ë‹Œì§€ í™•ì¸í•˜ëŠ” ë°©ë²•ì€ ë¬´ì—‡ì¼ê¹Œ?</p>

<p>ì •ë‹µì€ <strong>ì‰˜ì„ ì‚¬ìš©í•˜ì—¬ <code class="language-plaintext highlighter-rouge">netstat</code>ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œì¼œ í™•ì¸í•˜ëŠ” ê²ƒì´ë‹¤.</strong></p>

<p><code class="language-plaintext highlighter-rouge">netstat -nat | grep LISTEN | grep {port}</code></p>

<p><br /></p>

<p>ìë°”ì—ì„  í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ í™˜ê²½ê³¼ì˜ ì¸í„°í˜ì´ìŠ¤ì¸ <code class="language-plaintext highlighter-rouge">Runtime</code> ê°ì²´ë¥¼ ì œê³µí•œë‹¤.</p>

<blockquote>
  <p>ShellTest</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShellTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">shellTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">// port</span>
        <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">22</span><span class="o">;</span>

        <span class="c1">// netstat</span>
        <span class="nc">String</span> <span class="n">command</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"netstat -nat | grep LISTEN | grep %d"</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">shell</span> <span class="o">=</span> <span class="o">{</span><span class="s">"/bin/sh"</span><span class="o">,</span> <span class="s">"-c"</span><span class="o">,</span> <span class="n">command</span><span class="o">};</span>
        <span class="nc">Process</span> <span class="n">process</span> <span class="o">=</span> <span class="nc">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">shell</span><span class="o">);</span>

        <span class="c1">// InputStreamì„ í†µí•´ ì½ê¸°</span>
        <span class="nc">String</span> <span class="n">line</span><span class="o">;</span>
        <span class="nc">StringBuilder</span> <span class="n">pidInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">BufferedReader</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">process</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())))</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">pidInfo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">pidInfo</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰í•´ì„œ ë§Œì•½ ì—°ê²°ëœ <strong>portê°€ ìˆë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ pidInfoê°€ ëœ¬ë‹¤.</strong></p>

<p align="center"><img src="../assets/img/binghe/21-10-19-embedded-redis-server/find_port_result_true.png" /></p>

<p>ë°˜ë©´ì—, ì•„ë¬´ëŸ° portë„ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ì•„ë¬´ ë¬¸ìì—´ë¡œ ëœ¨ì§€ ì•ŠëŠ”ë‹¤. (<code class="language-plaintext highlighter-rouge">isEmpty()</code>)</p>

<p><br /></p>

<p>ì´ë¥¼ ì‚¬ìš©í•´ì„œ portë¥¼ ì°¾ê³  ì—°ê²°í•˜ëŠ” ê³¼ì •ì„ ìë™í™” ì‹œí‚¤ë©´ ëœë‹¤.</p>

<blockquote>
  <p><strong>ìˆ˜ì •ëœ EmbeddedRedisConfig</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@Profile</span><span class="o">(</span><span class="s">"!prod"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmbeddedRedisConfig</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">BIN_SH</span> <span class="o">=</span> <span class="s">"/bin/sh"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">BIN_SH_OPTION</span> <span class="o">=</span> <span class="s">"-c"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">COMMAND</span> <span class="o">=</span> <span class="s">"netstat -nat | grep LISTEN|grep %d"</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">redisPort</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">RedisServer</span> <span class="n">redisServer</span><span class="o">;</span>

    <span class="c1">// ì•„ë˜ì²˜ëŸ¼ ë¹ˆì„ ê¼­ ì—¬ê¸°ì„œ ë“±ë¡í•´ì¤˜ì•¼ í•œë‹¤.</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RedisConnectionFactory</span> <span class="nf">redisConnectionFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">LettuceConnectionFactory</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="n">redisPort</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">redisServer</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="n">isRedisRunning</span><span class="o">()</span> <span class="o">?</span> <span class="n">findAvailablePort</span><span class="o">()</span> <span class="o">:</span> <span class="n">redisPort</span><span class="o">;</span>
        <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="n">port</span><span class="o">);</span>
        <span class="n">redisServer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@PreDestroy</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopRedis</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">redisServer</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">redisServer</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">redisServer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isRedisRunning</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">isRunning</span><span class="o">(</span><span class="n">executeGrepProcessCommand</span><span class="o">(</span><span class="n">redisPort</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isRunning</span><span class="o">(</span><span class="nc">Process</span> <span class="n">process</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">line</span><span class="o">;</span>
        <span class="nc">StringBuilder</span> <span class="n">pidInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">BufferedReader</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">process</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())))</span> <span class="o">{</span>

            <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">pidInfo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
            <span class="o">}</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="o">!</span><span class="n">pidInfo</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Process</span> <span class="nf">executeGrepProcessCommand</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">command</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="no">COMMAND</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">shell</span> <span class="o">=</span> <span class="o">{</span><span class="no">BIN_SH</span><span class="o">,</span> <span class="no">BIN_SH_OPTION</span><span class="o">,</span> <span class="n">command</span><span class="o">};</span>
        <span class="k">return</span> <span class="nc">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">shell</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">findAvailablePort</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">10000</span><span class="o">;</span> <span class="n">port</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="o">;</span> <span class="n">port</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">Process</span> <span class="n">process</span> <span class="o">=</span> <span class="n">executeGrepProcessCommand</span><span class="o">(</span><span class="n">port</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">isRunning</span><span class="o">(</span><span class="n">process</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">port</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Not Found Available port: 10000 ~ 65535"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ì–´ë µê²Œ ìƒê°í•  í•„ìš”ì—†ë‹¤. ê·¸ì € ê¸°ì¡´ì˜ ì„¤ì • íŒŒì¼ì— ì„¤ì •ëœ portê°€ ì´ë¯¸ ì‚¬ìš©ì¤‘ì´ë¼ë©´ 10000ë¶€í„° ì°¨ë¡€ëŒ€ë¡œ portë¥¼ ì„¤ì •í•˜ì—¬ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ë‹¤.</p>

<p><strong>ì—¬ê¸°ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê°œë…ì€ <code class="language-plaintext highlighter-rouge">RedisConfig</code>ì—ì„œ ë°”ë¼ë³´ëŠ” portì™€ ë‚´ì¥ Redis ì„œë²„ì˜ portê°€ ê°™ì•„ì•¼í•œë‹¤ëŠ” ì ì´ë‹¤!</strong></p>

<p>ê·¸ëŸ¬ë¯€ë¡œ, <code class="language-plaintext highlighter-rouge">RedisConfig</code>ì˜ ì½”ë“œë„ ìˆ˜ì •í•´ì¤˜ì•¼í•œë‹¤.</p>

<p><br /></p>

<blockquote>
  <p><strong>RedisConfig</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableRedisRepositories</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisConfig</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.host}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">redisHost</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.redis.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">redisPort</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="nc">RedisConnectionFactory</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// ìˆ˜ì •ëœ ë¶€ë¶„!</span>
    <span class="kd">public</span> <span class="nc">RedisConnectionFactory</span> <span class="nf">redisConnectionFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">LettuceConnectionFactory</span><span class="o">(</span><span class="n">redisHost</span><span class="o">,</span> <span class="n">redisPort</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RedisTemplate</span><span class="o">&lt;?,</span> <span class="o">?&gt;</span> <span class="n">redisTemplate</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">RedisTemplate</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">redisTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisTemplate</span><span class="o">&lt;&gt;();</span>
        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">redisConnectionFactory</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ <strong>ë‚´ì¥ Redis ì„œë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ê³¼ ì™¸ì¥ Redis ì„œë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ì„ ë¶„ë¦¬í• ê¹Œ?</strong></p>

<p><strong>ë°”ë¡œ <code class="language-plaintext highlighter-rouge">@ConditionalOnMissingBean</code>ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.</strong></p>

<p><strong>ì´ ì• ë…¸í…Œì´ì…˜ì€ ê¸°ì¡´ì— ê°™ì€ ë¹ˆì´ ë“±ë¡ë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ë©”ì„œë“œì˜ ë¹ˆì€ ë“±ë¡í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.</strong></p>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ê¸°ì¡´ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¤ë³´ë©´ ì •ìƒ í†µê³¼í•œë‹¤. ì´ì™¸ì—ë„ í†µí•© í…ŒìŠ¤íŠ¸ì‹œ ì—¬ëŸ¬ ëŒ€ì˜ ë‚´ì¥ Redis ì„œë²„ë¥¼ ì¼œë„ ë¬¸ì œ ì—†ì´ ì‹¤í–‰ëœë‹¤.</p>

<p><br /></p>

<h1 id="ì‚¬ìš©ì‹œ-ì£¼ì˜í• -ì ---ì¤‘ìš”">ì‚¬ìš©ì‹œ ì£¼ì˜í•  ì  - ì¤‘ìš”</h1>
<p>ë‚´ì¥ Redisë¥¼ ì‚¬ìš©í•˜ë©° ê²ªì—ˆë˜ ê²½í—˜ê³¼ ì£¼ì˜í•  ì ì„ ì´ê³³ì— ë‚¨ê²¨ë‘”ë‹¤. (ë¶€ë“¤ë¶€ë“¤ ğŸ˜ )</p>

<p><br /></p>

<h2 id="ë©”ëª¨ë¦¬-í™•ì¸">ë©”ëª¨ë¦¬ í™•ì¸</h2>
<p>ë‚´ì¥ Redis Serverë„ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ê°„ë‹¤.</p>

<p>ê·¸ë¦¬ê³  í…ŒìŠ¤íŠ¸ì‹œ ë§ì€ ë‚´ì¥ Redis Serverë¥¼ í‚¤ë‹¤ë³´ë©´, ë©”ëª¨ë¦¬ ë¶€ì¡±ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.</p>

<p>ì´ëŸ´ ê²½ìš° Redis ì„¤ì •ì—ì„œ ë©”ëª¨ë¦¬ ì„¤ì •ì„ í•´ì£¼ë©´ ëœë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostConstruct</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">redisServer</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">redisPort</span> <span class="o">=</span> <span class="n">isRedisRunning</span><span class="o">()</span> <span class="o">?</span> <span class="n">findAvailablePort</span><span class="o">()</span> <span class="o">:</span> <span class="n">port</span><span class="o">;</span>
    <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="n">redisPort</span><span class="o">);</span>
    <span class="n">redisServer</span> <span class="o">=</span> <span class="nc">RedisServer</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">port</span><span class="o">(</span><span class="n">redisPort</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setting</span><span class="o">(</span><span class="s">"maxmemory 128M"</span><span class="o">)</span> <span class="c1">//maxheap 128M</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="n">redisServer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Redisì— ì €ì¥ë˜ëŠ” ë°ì´í„°ì˜ ìš©ëŸ‰ì´ 128Mê°€ ë„˜ì–´ê°€ë©´, ê¸°ì¡´ì˜ ë°ì´í„°ë¥¼ ë®ì–´ì”Œìš°ëŠ” ë°©ì‹ìœ¼ë¡œ ì¼ì • ë©”ëª¨ë¦¬ ì´ìƒ ì°¨ì§€í•˜ì§€ ëª»í•˜ê²Œ í•œë‹¤.</p>

<p><br /></p>

<h2 id="netstat-í™•ì¸">netstat í™•ì¸</h2>

<p>ë§Œì•½ ë‘ë²ˆì§¸ ë°©ë²•ì¸ <a href="#ë‚´ì¥-redis-port-ìë™-ì„¤ì •">ë‚´ì¥ Redis port ìë™ ì„¤ì •</a>ë¥¼ ì‚¬ìš©í•œë‹¤ë©´, í•´ë‹¹ ì½”ë“œê°€ ì–´ëŠ í™˜ê²½ì—ì„œ ë„ëŠ”ì§€ í™•ì¸í•´ì•¼í•œë‹¤.</p>

<p>í•„ìëŠ” í”„ë¡œì íŠ¸ë¥¼ í•˜ë©° ë‚´ì¥ Redisë¥¼ êµ¬í˜„í•˜ì—¬ ì‚¬ìš©í•˜ë˜ì¤‘, ì  í‚¨ìŠ¤ì—ì„œë§Œ ê³„ì†í•´ì„œ ì˜ˆì™¸ê°€ ë°œìƒí–ˆë‹¤.</p>

<p>4ì‹œê°„ë™ì•ˆì˜ ì‚½ì§ˆ ëì— ì°¾ì€ ë¬¸ì œëŠ” ë„ì»¤ ì»¨í…Œì´ë„ˆì•ˆì— <code class="language-plaintext highlighter-rouge">netstat</code> ëª…ë ¹ì–´ê°€ <code class="language-plaintext highlighter-rouge">not found</code>ì˜€ê¸° ë•Œë¬¸ì´ë‹¤â€¦</p>

<p>í•´ë‹¹ ì»¨í…Œì´ë„ˆì•ˆì— <code class="language-plaintext highlighter-rouge">net-tools</code>ë¥¼ ì„¤ì¹˜í–ˆë”ë‹ˆ ì˜ ë™ì‘í•œë‹¤..</p>

<p><br /></p>

<p><strong>ë‚´ì¥ Redis ì„œë²„ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ìš°ì„  í¬íŠ¸ë¥¼ ì¡°ì‹¬í•˜ê³ , ë‘ ë²ˆì§¸ëŠ” í•´ë‹¹ í”„ë¡œê·¸ë¨ì´ ëŒì•„ê°€ëŠ” í™˜ê²½ì— <code class="language-plaintext highlighter-rouge">net-tools</code>ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì.</strong>
<br /></p>

<h2 id="m1">M1</h2>

<p>M1 í™˜ê²½ì—ì„œ Redis ë‚´ì¥ ì„œë²„ë¥¼ ì‹œë™ì‹œí‚¤ë©´ ì•„ë˜ì™€ ê°™ì€ ë©”ì‹œì§€ê°€ ëœ¬ë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">RuntimeException</span><span class="o">:</span> <span class="nc">Can</span><span class="err">'</span><span class="n">t</span> <span class="n">start</span> <span class="n">redis</span> <span class="n">server</span><span class="o">.</span> <span class="nc">Check</span> <span class="n">logs</span> <span class="k">for</span> <span class="n">details</span><span class="o">.</span>
</code></pre></div></div>

<p>ì›ì¸ì€ ë‚´ì¥ Redis ë¼ì´ë¸ŒëŸ¬ë¦¬ì— <code class="language-plaintext highlighter-rouge">mac_arm64</code>ìš© ë°”ì´ë„ˆë¦¬ê°€ ì¤€ë¹„ë˜ì–´ ìˆì§€ ì•Šì•„ì„œ ê·¸ë ‡ë‹¤.</p>

<p><br /></p>

<p>ìš°ì„  <a href="https://redis.io/download">Redis ì†ŒìŠ¤ ì½”ë“œ</a>ë¥¼ ë‹¤ìš´ë°›ì•„ ì»´íŒŒì¼í•˜ë©´, Redis Server ì»´íŒŒì¼ íŒŒì¼ì´ ìƒê¸´ë‹¤.</p>

<p>í•´ë‹¹ íŒŒì¼ì„ í”„ë¡œì íŠ¸ì˜ resources ë””ë ‰í„°ë¦¬ì— ë³µì‚¬í•˜ê³ , ClassPathResource ë¡œ ë¶ˆëŸ¬ì˜¤ì‹œë©´ ëœë‹¤.</p>

<p align="center"><img src="../assets/img/binghe/21-10-19-embedded-redis-server/m1_issue.png" width="400" /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">redisServer</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">URISyntaxException</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">redisPort</span> <span class="o">=</span> <span class="n">isRedisRunning</span><span class="o">()</span> <span class="o">?</span> <span class="n">findAvailablePort</span><span class="o">()</span> <span class="o">:</span> <span class="n">port</span><span class="o">;</span>
  <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="n">redisPort</span><span class="o">);</span>

  <span class="k">if</span> <span class="o">(</span><span class="n">isArmMac</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">getRedisFileForArcMac</span><span class="o">()),</span>
                                  <span class="n">redisPort</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(!</span><span class="n">isArmMac</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisServer</span><span class="o">(</span><span class="n">redisPort</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="n">redisServer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isArmMac</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"os.arch"</span><span class="o">),</span> <span class="s">"aarch64"</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
    <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"os.name"</span><span class="o">),</span> <span class="s">"Mac OS X"</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="nc">File</span> <span class="nf">getRedisFileForArcMac</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">ClassPathResource</span><span class="o">(</span><span class="s">"binary/redis/redis-server-6.2.5-mac-arm64"</span><span class="o">).</span><span class="na">getFile</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmbeddedRedisServerException</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p><a href="https://github.com/woowacourse-teams/2021-pick-git/pull/576">M1 Embedded Redis ë¬¸ì œ í•´ê²° PR - by ë‹¤ë‹ˆ</a>ì—ì„œ ì „ì²´ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
</blockquote>

<p><br /></p>

<h1 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h1>
<p>ì²˜ìŒì—” ë‚´ì¥ Redis Serverë¥¼ ì–´ë–»ê²Œ êµ¬ì¶•í•´ì•¼í•˜ë‚˜ ë§‰ë§‰í–ˆì—ˆë‹¤â€¦ ê·¸ë˜ë„ <a href="https://jojoldu.tistory.com/297">ì´ë™ìš±ë‹˜ì˜ ê¸€</a>ë¥¼ ë³´ê³  ë§ì€ ë„ì›€ì„ ë°›ì•˜ë‹¤.</p>

<p>ë‹¤ë§Œ ìƒê°ë³´ë‹¨ ì¶”ìƒì ì¸ ë¶€ë¶„ì´ ë§ì•„ ì‚½ì§ˆì„ ë§ì´ í•˜ê²Œë˜ì—ˆë‹¤.</p>

<p>ì‹¤ì œ í”„ë¡œì íŠ¸ì— ì ìš©ì‹œì¼°ì„ ë•Œ ë§ì€ ë¬¸ì œê°€ ì•¼ê¸°ë˜ì—ˆê³ , ì´ë²ˆ ê¸€ì„ ì“°ê²Œ ëœ ê³„ê¸°ê°€ ë˜ì—ˆë‹¤.</p>

<p>ì¨‹ë“ ! êµ‰ì¥íˆ ì¢‹ì€ ì§€ì‹ì„ ì–»ì–´ê°„ë‹¤.</p>

<p>í˜„ì¬ëŠ” í† í°ê³¼ ìºì‹œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ìš©ë„ë¡œë§Œ Redisë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ë©”ì‹œì§€ íì™€ ê°™ì€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•Œ Redisë¥¼ ì‚¬ìš©í•˜ê¸°ì— ë‚´ì¥ Redis ì„œë²„ê°€ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë  ë“¯í•˜ë‹¤.</p>

<p><br /></p>

<h1 id="ì°¸ê³ ">ì°¸ê³ </h1>

<ul>
  <li>https://jojoldu.tistory.com/297</li>
  <li>https://www.baeldung.com/spring-embedded-redis</li>
  <li>http://arahansa.github.io/docs_spring/redis.html</li>
  <li>https://velog.io/@hakjong/ARM-Mac-M1-%EC%97%90%EC%84%9C-embedded-redis-%EC%82%AC%EC%9A%A9</li>
</ul>

      <div class="page-footer">
        <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=ë‚´ì¥ Redis ì„¤ì •ê¸°&url=https://2021-pick-git.github.io//embedded-redis-server/" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=https://2021-pick-git.github.io//embedded-redis-server/" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=https://2021-pick-git.github.io//embedded-redis-server/" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div>
        <div class="page-tag">
          
            <a href="/tags#ë°±ì—”ë“œ" class="tag">&#35; ë°±ì—”ë“œ</a>
          
            <a href="/tags#Redis" class="tag">&#35; Redis</a>
          
            <a href="/tags#Embedded" class="tag">&#35; Embedded</a>
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->

  <script src="https://utteranc.es/client.js"
        repo="2021-pick-git/pick-git-comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
</article> <!-- End Article Page -->

</div>

  </div>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
